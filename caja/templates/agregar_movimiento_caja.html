{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agregar Movimiento de Caja</title>
    <link rel="stylesheet" href="{% static 'CSS/movimientos_caja.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-movimientos">
        <!-- Encabezado -->
        <div class="encabezado-movimientos">
            <div class="titulo-encabezado">
                <h2>ðŸ›’ SuperMercado La Merced</h2>
                <p class="subtitulo">Agregar Movimiento de Caja</p>
            </div>
            <div class="info-usuario">
                <div class="usuario-info">
                    <span class="icono-usuario">ðŸ‘¤</span>
                    <span>Usuario: {{ usuario_nombre }}</span>
                </div>
                <div class="usuario-fecha">
                    <span>{{ fecha_actual }}</span>
                </div>
            </div>
        </div>

        <!-- InformaciÃ³n de caja -->
        {% if caja_activa %}
        <div class="info-caja-activa">
            <div class="caja-info">
                <h3>ðŸ“¦ Caja Activa</h3>
                <p><strong>{{ caja_activa.nombrecaja }}</strong></p>
                <p>Monto Inicial: ${{ caja_activa.montoinicialcaja|floatformat:2 }}</p>
                {% if ultimo_movimiento %}
                <p>Saldo Actual: ${{ ultimo_movimiento.saldomovcaja|floatformat:2 }}</p>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="alerta-caja">
            <div class="alerta-content">
                <i class="fas fa-exclamation-triangle"></i>
                <span>No hay caja activa. Los movimientos se registrarÃ¡n en Caja General.</span>
            </div>
        </div>
        {% endif %}

        <!-- Formulario -->
        <form method="post" class="formulario-movimiento" id="form-movimiento">
            {% csrf_token %}
            
            <div class="panel-formulario">
                <div class="panel-encabezado">
                    <h2>ðŸ“‹ Datos del Movimiento</h2>
                </div>
                
                <div class="panel-cuerpo">
                    <!-- Campos automÃ¡ticos -->
                    <div class="campos-automaticos">
                        <div class="campo-grupo">
                            <label>Usuario</label>
                            <input type="text" class="form-control" value="{{ usuario_nombre }}" readonly>
                        </div>
                        
                        <div class="campo-grupo">
                            <label>Caja</label>
                            <input type="text" class="form-control" 
                                   value="{{ caja_activa.nombrecaja|default:'Caja General' }}" readonly>
                        </div>
                        
                        <div class="campo-grupo">
                            <label>Fecha</label>
                            <input type="text" class="form-control" value="{{ fecha_actual }}" readonly>
                        </div>
                        
                        <div class="campo-grupo">
                            <label>Hora</label>
                            <input type="text" class="form-control" value="{{ hora_actual }}" readonly>
                        </div>
                    </div>

                    <!-- Campos a completar -->
                    <div class="campos-completar">
                        <div class="campo-grupo">
                            <label for="tipo">Tipo *</label>
                            <select name="tipo" id="tipo" class="form-control" required>
                                <option value="">Seleccionar Tipo</option>
                                <option value="APERTURA">Apertura</option>
                                <option value="INGRESO">Ingreso</option>
                                <option value="EGRESO">Egreso</option>
                                <option value="CIERRE">Cierre</option>
                            </select>
                        </div>

                        <div class="campo-grupo">
                            <label for="concepto">Concepto *</label>
                            <select name="concepto" id="concepto" class="form-control" required>
                                <option value="">Seleccionar Concepto</option>
                                <option value="Arqueo final">Arqueo final</option>
                                <option value="Venta de Producto">Venta de Producto</option>
                                <option value="Pago de sueldos">Pago de sueldos</option>
                                <option value="Fondo Inicial">Fondo Inicial</option>
                                <option value="Pago de servicios">Pago de servicios</option>
                                <option value="Pago Proveedor">Pago Proveedor</option>
                                <option value="Transf. a Caja">Transf. a Caja</option>
                                <option value="Gastos varios">Gastos varios</option>
                                <option value="Ajuste de caja">Ajuste de caja</option>
                                <option value="Otros">Otros</option>
                            </select>
                        </div>

                        <div class="campo-grupo">
                            <label for="valor">Valor *</label>
                            <div class="input-con-icono">
                                <span class="icono-moneda">$</span>
                                <input type="number" name="valor" id="valor" class="form-control" 
                                       step="0.01" min="0.01" placeholder="Ingrese un valor" required>
                            </div>
                            <small class="text-muted">Ingrese el monto del movimiento</small>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="botones-accion">
                        <a href="{% url 'caja:movimientos_caja_menu' %}" class="btn btn-secundario">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </a>
                        <button type="submit" class="btn btn-primario" id="btn-submit">
                            <i class="fas fa-check"></i>
                            Aceptar
                        </button>
                    </div>
                </div>
            </div>
        </form>

        <!-- Mensajes -->
        {% if messages %}
        <div class="mensajes-container">
            {% for message in messages %}
            <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'JS/movimientos_caja.js' %}"></script>
</body>
</html>