{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{% static 'CSS/stylecajaApertura.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Apertura de Caja</title>
</head>
<body>
  <div class="MargenesCaja">
    <div class="EncabezadoCajaApertura">
      <div class="TituloEncabezadoCajaAper">
        <h2>🛒 SuperMercado La Merced</h2>
        <p class="SubtituloSuper">Apertura de Caja</p>
      </div>
      <div class="EncabezadoInfoUsu">
        <div class="UsuarioInfo">
          <span class="IconoUsu">👤</span>
          <span id="nombreusuario">Cajero: {{ usuario_nombre }}</span>
        </div>
        <div class="UsuarioFecha">
          <span id="fecha-actual">{{ fecha_actual }}</span>
        </div>
      </div>
    </div>

    <div class="EstadoCaja" id="EstadoCaja">
      <div class="EstadoCajaEncabezado">
        <h2>ESTADO DE CAJA</h2>
        <div class="EstadoIndicador" id="EstadoIndicador">
          <span class="EstadoCirculo"></span>
          <span class="EstadoTexto">CERRADA</span>
        </div>
      </div>
      <div class="EstadoDetalles">
        {% if ultimo_cierre %}
          {% if ultimo_cierre.diferencia == '0.00' %}
            <p id="EstadoMensaje" class="estado-ok">✅ Último cierre: Sin diferencias</p>
          {% elif ultimo_cierre.diferencia|floatformat:2 > '0' %}
            <p id="EstadoMensaje" class="estado-sobrante">⚠ Último cierre: SOBRANTE ${{ ultimo_cierre.diferencia }}</p>
          {% else %}
            <p id="EstadoMensaje" class="estado-faltante">⚠ Último cierre: FALTANTE ${{ ultimo_cierre.diferencia|cut:"-" }}</p>
          {% endif %}
        {% else %}
          <p id="EstadoMensaje" class="estado-neutral">Listo para apertura - No hay cajas abiertas</p>
        {% endif %}
        
        <div class="UltimaOperacion" id="UltimaOperacion">
          {% if ultimo_cierre %}
            🕒 Último cierre: {{ ultimo_cierre.fecha }} {{ ultimo_cierre.hora }} - {{ ultimo_cierre.usuario }}
            {% if ultimo_cierre.monto_final %}
              <br>💰 Monto final: ${{ ultimo_cierre.monto_final|floatformat:2 }}
            {% endif %}
          {% else %}
            🕒 No hay registros de cierres recientes
          {% endif %}
        </div>
      </div>
    </div>

    <div class="AperturaPanel" id="AperturaPanelID">
      <div class="PanelAperEncabezado">
        <h2>📋 Apertura de Caja</h2>
      </div>
    </div>

    <!-- FORM -->
    <form method="post">
      {% csrf_token %}
      <div class="AperturaPanelCuerpo">
        <div class="FormularioMontoIni">
          <label for="id_montoinicialcaja">💰 Fondo Inicial</label>
          <div class="FormularioInputMontoIni">
            <span class="divisa">$</span>
            {{ form.montoinicialcaja }}
          </div>
        </div>

        <div class="FormularioMontoIni">
          <label for="id_observacionapertura">📝 Observaciones:</label>
          {{ form.observacionapertura }}
        </div>

        <div class="boton1" style="display: flex; gap: 10px;">
            <a href="{% url 'inicio' %}" class="boton boton-secundario"> Cancelar</a>
            <button type="submit" id="boton-apertura" class="boton boton-primario"> Registrar Apertura</button>
        </div>
      </div>
    </form>

    <div class="abajo"></div>

    {% if messages %}
      <div id="notification" class="alert alert-info" style="display:none;">
        {% for message in messages %}
          {{ message }}
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <script src="{% static 'JS/apertura_caja.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>




