{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"/>
  <title>La Merced Comestibles - Sistema de Gestión</title>

  <!-- Material Icons + Roboto -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <h1><i class="material-icons">store</i> La Merced <span>Comestibles</span></h1>
      </div>
      <div class="user-info">
        <span>Administrador</span>
        <i class="material-icons">account_circle</i>
      </div>
    </header>

    <div class="main-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="nav-menu">
          <ul>
            <li class="nav-item active" data-section="dashboard">
              <i class="material-icons">dashboard</i><span>Dashboard</span>
            </li>
            <li class="nav-item" data-section="productos">
              <i class="material-icons">inventory_2</i><span>Productos</span>
            </li>
            <li class="nav-item" data-section="categorias">
              <i class="material-icons">category</i><span>Categorías</span>
            </li>
            <li class="nav-item" data-section="proveedores">
              <i class="material-icons">local_shipping</i><span>Proveedores</span>
            </li>
            <li class="nav-item" data-section="movimientos">
              <i class="material-icons">swap_horiz</i><span>Movimientos</span>
            </li>
            <li class="nav-item" data-section="ventas">
              <i class="material-icons">point_of_sale</i><span>Ventas</span>
            </li>
            <li class="nav-item" data-section="reportes">
              <i class="material-icons">bar_chart</i><span>Reportes</span>
            </li>
            <li class="nav-item" data-section="stock-bajo">
              <i class="material-icons">warning</i><span>Stock Bajo</span>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Content -->
      <main class="content">
        <!-- Dashboard -->
        <div class="section active" id="dashboard-section">
          <h2>Dashboard</h2>
          <div class="dashboard-cards">
            <div class="card">
              <div class="card-icon"><i class="material-icons">inventory_2</i></div>
              <div class="card-info">
                <h3>Total Productos</h3>
                <p id="total-productos">0</p>
              </div>
            </div>
            <div class="card">
              <div class="card-icon"><i class="material-icons">point_of_sale</i></div>
              <div class="card-info">
                <h3>Ventas Hoy</h3>
                <p id="ventas-hoy">$0</p>
              </div>
            </div>
            <div class="card">
              <div class="card-icon"><i class="material-icons">local_shipping</i></div>
              <div class="card-info">
                <h3>Total Proveedores</h3>
                <p id="total-proveedores">0</p>
              </div>
            </div>
            <div class="card danger" id="stock-bajo-card">
              <div class="card-icon"><i class="material-icons">warning</i></div>
              <div class="card-info">
                <h3>Stock Bajo</h3>
                <p id="total-stock-bajo">0</p>
              </div>
            </div>
          </div>

          <div class="dashboard-charts">
            <div class="chart-container">
              <h3>Ventas Mensuales</h3>
              <div class="chart"><canvas id="salesChart"></canvas></div>
            </div>
            <div class="chart-container">
              <h3>Productos Más Vendidos</h3>
              <div class="chart"><canvas id="productsChart"></canvas></div>
            </div>
          </div>
        </div>

        <!-- Productos -->
        <div class="section" id="productos-section">
          <h2>Gestión de Productos</h2>
          <div class="section-header">
            <button class="btn btn-primary" onclick="openModal('producto')">
              <i class="material-icons">add</i> Nuevo Producto
            </button>
            <div class="search-box">
              <input type="text" placeholder="Buscar producto..." onkeyup="filterTable('productos-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table" id="productos-table">
              <thead>
              <tr>
                <th>ID</th><th>Imagen</th><th>Nombre</th><th>Precio</th><th>Marca</th>
                <th>Código Barras</th><th>Categoría</th><th>Proveedor</th><th>Stock</th><th>Acciones</th>
              </tr>
              </thead>
              <tbody id="productos-body"></tbody>
            </table>
          </div>
        </div>

        <!-- Stock Bajo -->
        <div class="section" id="stock-bajo-section">
          <h2>
            Productos con Stock Bajo
            <span class="badge" id="badge-stock-bajo">0 productos</span>
          </h2>
          <div class="section-header">
            <button class="btn btn-warning" onclick="generarReporteStockBajo()">
              <i class="material-icons">picture_as_pdf</i> Generar Reporte
            </button>
            <div class="search-box">
              <input type="text" placeholder="Buscar..." onkeyup="filterTable('stock-bajo-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table" id="stock-bajo-table">
              <thead>
              <tr>
                <th>ID</th><th>Imagen</th><th>Nombre</th><th>Precio</th><th>Marca</th>
                <th>Código Barras</th><th>Categoría</th><th>Proveedor</th><th>Stock</th><th>Stock Mínimo</th><th>Acciones</th>
              </tr>
              </thead>
              <tbody id="stock-bajo-body"></tbody>
            </table>
          </div>
        </div>

        <!-- Proveedores -->
        <div class="section" id="proveedores-section">
          <h2>Gestión de Proveedores</h2>
          <div class="section-header">
            <button class="btn btn-primary" onclick="openModal('proveedor')">
              <i class="material-icons">add</i> Nuevo Proveedor
            </button>
            <div class="search-box">
              <input type="text" placeholder="Buscar proveedor..." onkeyup="filterTable('proveedores-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table" id="proveedores-table">
              <thead>
              <tr>
                <th>ID</th><th>Nombre</th><th>Teléfono</th><th>Email</th><th>CUIT</th><th>Acciones</th>
              </tr>
              </thead>
              <tbody id="proveedores-body"></tbody>
            </table>
          </div>
        </div>

        <!-- Categorías -->
        <div class="section" id="categorias-section">
          <h2>Gestión de Categorías</h2>
          <div class="section-header">
            <button class="btn btn-primary" onclick="openModal('categoria')">
              <i class="material-icons">add</i> Nueva Categoría
            </button>
            <div class="search-box">
              <input type="text" placeholder="Buscar categoría..." onkeyup="filterTable('categorias-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>
          <div class="table-container">
            <table class="data-table" id="categorias-table">
              <thead>
              <tr>
                <th>ID</th><th>Nombre</th><th>Descripción</th><th>N° Productos</th><th>Acciones</th>
              </tr>
              </thead>
              <tbody id="categorias-body"></tbody>
            </table>
          </div>
        </div>

        <!-- MOVIMIENTOS -->
        <div class="section" id="movimientos-section">
          <h2>Movimientos de Stock</h2>

          <div class="section-header">
            <button class="btn btn-primary" onclick="openModal('movimiento')">
              <i class="material-icons">add</i> Nuevo Movimiento
            </button>
            <div class="search-box">
              <input type="text" placeholder="Buscar..." onkeyup="filterTable('movimientos-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="movimientos-table">
              <thead>
              <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Producto</th>
                <th>Tipo</th>
                <th>Cantidad</th>
                <th>Stock resultante</th>
                <th>Notas</th>
              </tr>
              </thead>
              <tbody id="movimientos-body"></tbody>
            </table>
          </div>
        </div>

        <!-- VENTAS (SOLO HISTORIAL) -->
        <div class="section" id="ventas-section">
          <h2>Historial de Ventas</h2>

          <div class="section-header">
            <span class="badge" title="Esta sección es solo lectura">Solo historial</span>
            <div class="search-box">
              <input type="text" placeholder="Buscar..." onkeyup="filterTable('ventas-table', this.value)">
              <i class="material-icons">search</i>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table" id="ventas-table">
              <thead>
              <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
                <th>Total</th>
                <th>Método</th>
                <th>Estado</th>
              </tr>
              </thead>
              <tbody id="ventas-body"></tbody>
            </table>
          </div>
        </div>

      </main>
    </div>
  </div>

  <!-- Modal Producto -->
  <div id="modal-producto" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('producto')">&times;</span>
      <h2 id="modal-producto-title">Nuevo Producto</h2>
      <form id="form-producto">
        <input type="hidden" id="producto-id" value="">
        <div class="form-row">
          <div class="form-group">
            <label for="producto-nombre">Nombre:</label>
            <input type="text" id="producto-nombre" required>
          </div>
          <div class="form-group">
            <label for="producto-precio">Precio:</label>
            <input type="number" id="producto-precio" step="0.01" min="0" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="producto-marca">Marca:</label>
            <input type="text" id="producto-marca" required>
          </div>
          <div class="form-group">
            <label for="producto-codigo">Código de Barras:</label>
            <input type="text" id="producto-codigo" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="producto-categoria">Categoría:</label>
            <select id="producto-categoria" required>
              <option value="">Seleccionar categoría</option>
            </select>
          </div>
          <div class="form-group">
            <label for="producto-proveedor">Proveedor:</label>
            <select id="producto-proveedor" required>
              <option value="">Seleccionar proveedor</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="producto-stock">Stock:</label>
            <input type="number" id="producto-stock" min="0" required>
          </div>
          <div class="form-group">
            <label for="producto-stock-min">Stock Mínimo:</label>
            <input type="number" id="producto-stock-min" min="0" value="10" required>
          </div>
        </div>
        <div class="form-group">
          <label for="producto-imagen">Imagen del Producto:</label>
          <input type="file" id="producto-imagen" accept="image/*">
          <div class="image-preview" id="image-preview"><span>Vista previa</span></div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('producto')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Proveedor -->
  <div id="modal-proveedor" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('proveedor')">&times;</span>
      <h2 id="modal-proveedor-title">Nuevo Proveedor</h2>
      <form id="form-proveedor">
        <input type="hidden" id="proveedor-id" value="">
        <div class="form-row">
          <div class="form-group">
            <label for="proveedor-nombre">Nombre:</label>
            <input type="text" id="proveedor-nombre" required>
          </div>
          <div class="form-group">
            <label for="proveedor-telefono">Teléfono:</label>
            <input type="tel" id="proveedor-telefono" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="proveedor-email">Email:</label>
            <input type="email" id="proveedor-email" required>
          </div>
          <div class="form-group">
            <label for="proveedor-cuit">CUIT:</label>
            <input type="text" id="proveedor-cuit" placeholder="XX-XXXXXXXX-X" required>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('proveedor')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Categoría -->
  <div id="modal-categoria" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('categoria')">&times;</span>
      <h2 id="modal-categoria-title">Nueva Categoría</h2>
      <form id="form-categoria">
        <input type="hidden" id="categoria-id" value="">
        <div class="form-group">
          <label for="categoria-nombre">Nombre:</label>
          <input type="text" id="categoria-nombre" required>
        </div>
        <div class="form-group">
          <label for="categoria-descripcion">Descripción:</label>
          <textarea id="categoria-descripcion" rows="3"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('categoria')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Movimiento -->
  <div id="modal-movimiento" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('movimiento')">&times;</span>
      <h2 id="modal-movimiento-title">Nuevo Movimiento</h2>

      <form id="form-movimiento">
        <div class="form-row">
          <div class="form-group">
            <label for="mov-producto">Producto</label>
            <select id="mov-producto" required></select>
          </div>
          <div class="form-group">
            <label for="mov-tipo">Tipo</label>
            <select id="mov-tipo" required>
              <option value="">Seleccionar</option>
              <option value="Entrada">Entrada</option>
              <option value="Salida">Salida</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="mov-cantidad">Cantidad</label>
            <input type="number" id="mov-cantidad" min="1" required>
          </div>
          <div class="form-group">
            <label for="mov-fecha">Fecha</label>
            <input type="date" id="mov-fecha" required>
          </div>
        </div>

        <div class="form-group">
          <label for="mov-notas">Notas</label>
          <textarea id="mov-notas" rows="2"></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('movimiento')">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JS -->
  <script defer src="{% static 'js/script2.js' %}"></script>
</body>
</body>
</html>
