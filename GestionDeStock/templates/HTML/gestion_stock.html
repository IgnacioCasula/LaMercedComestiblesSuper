<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Stock - La Merced Comestibles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ===== RESET Y BASE ===== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Roboto', sans-serif; 
        }

        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --bg: #f5f6fa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(80px);
            pointer-events: none;
            z-index: 0;
        }

        body::before {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #a8d5e2 0%, transparent 70%);
            top: -150px;
            left: -150px;
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #e3a8e4 0%, transparent 70%);
            bottom: -200px;
            right: -200px;
            animation: float 25s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        /* ===== CONTAINER ===== */
        .container { 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            height: 80px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo h1 { 
            display: flex; 
            align-items: center; 
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--dark);
            gap: 12px;
        }

        .logo h1 i {
            color: var(--primary);
            font-size: 2rem;
        }

        .logo span { 
            color: var(--secondary);
            font-weight: 400;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--dark);
        }

        .user-info i {
            color: var(--primary);
            font-size: 2rem;
        }

        .back-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--secondary) 0%, #5a6268 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            border: none;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content { 
            display: flex; 
            flex: 1;
            padding: 20px;
            gap: 20px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar { 
            width: 260px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .nav-menu ul { 
            list-style: none;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 25px;
            cursor: pointer;
            color: var(--dark);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.15) 0%, transparent 100%);
            border-left-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-item i {
            font-size: 1.5rem;
        }

        /* ===== CONTENT ===== */
        .content { 
            flex: 1;
            overflow: auto;
        }

        .section { 
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active { 
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            margin: 0 0 25px;
            color: var(--dark);
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .section h2 i {
            color: var(--primary);
        }

        /* ===== DASHBOARD CARDS ===== */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            display: flex;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            gap: 20px;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 5px solid;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-primary { border-color: var(--primary); }
        .card-success { border-color: var(--success); }
        .card-info { border-color: var(--info); }
        .card-danger { border-color: var(--danger); }
        .card-warning { border-color: var(--warning); }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .card-primary .card-icon {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .card-success .card-icon {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .card-info .card-icon {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .card-danger .card-icon {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .card-warning .card-icon {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: var(--dark);
        }

        .card-info h3 { 
            font-size: 1rem;
            color: var(--secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .card-info p { 
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0;
        }

        /* ===== SECTION HEADER ===== */
        .section-header { 
            display: flex;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .search-box { 
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 0 20px;
            box-shadow: var(--shadow);
            min-width: 300px;
        }

        .search-box input {
            padding: 14px 45px 14px 15px;
            border: none;
            background: transparent;
            width: 100%;
            font-size: 15px;
            outline: none;
        }

        .search-box i { 
            position: absolute;
            right: 20px;
            color: var(--secondary);
        }

        /* ===== TABLES ===== */
        .table-container { 
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .data-table { 
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 18px;
            text-align: left;
            font-weight: 600;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td { 
            padding: 16px 18px;
            border-bottom: 1px solid #f1f1f1;
            color: var(--dark);
        }

        .data-table tr:hover { 
            background: rgba(102, 126, 234, 0.05);
        }

        .product-image { 
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stock-bajo { 
            color: var(--danger);
            font-weight: 700;
        }

        .stock-optimo { 
            color: var(--success);
            font-weight: 700;
        }

        .stock-critico { 
            color: var(--danger);
            font-weight: 700;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .loading-cell {
            text-align: center;
            padding: 40px !important;
        }

        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .loading-spinner i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== PAGINATION ===== */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-top: 1px solid #f1f1f1;
        }

        .pagination-info {
            color: var(--secondary);
            font-size: 0.9rem;
        }

        .pagination {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #e1e5e9;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .pagination-btn:hover:not(.disabled) {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .pagination-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-ellipsis {
            padding: 0 10px;
            color: var(--secondary);
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #5a6268 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e0a800 100%);
            color: var(--dark);
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
        }

        .btn-icon.delete {
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .btn-icon.delete:disabled {
            color: #ccc;
            cursor: not-allowed;
            background: none;
        }

        .btn-icon.delete:disabled:hover {
            color: #ccc;
            background: none;
        }

        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid var(--warning);
        }

        .badge-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 1px solid var(--info);
        }

        .badge-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid var(--success);
        }

        .badge-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
            color: #721c24;
            border: 1px solid var(--danger);
        }

        .badge-secondary {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            color: #495057;
            border: 1px solid var(--secondary);
        }

        /* ===== ALERTAS VENCIMIENTO ===== */
        .vencimiento-proximo {
            color: var(--warning);
            font-weight: 600;
            background-color: rgba(255, 193, 7, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .vencimiento-critico {
            color: var(--danger);
            font-weight: 700;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .vencimiento-ok {
            color: var(--success);
            font-weight: 600;
            background-color: rgba(40, 167, 69, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .vencimiento-lejano {
            color: var(--info);
            font-weight: 600;
            background-color: rgba(23, 162, 184, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        /* ===== BADGES PARA PEDIDOS ===== */
        .badge-pedido {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .estado-pendiente { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid var(--warning);
        }

        .estado-confirmado { 
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 1px solid var(--info);
        }

        .estado-preparando { 
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid var(--success);
        }

        .estado-listo { 
            background: linear-gradient(135deg, #cce7ff 0%, #b3d7ff 100%);
            color: #004085;
            border: 1px solid #007bff;
        }

        .estado-entregado { 
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid var(--success);
        }

        .estado-cancelado { 
            background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
            color: #721c24;
            border: 1px solid var(--danger);
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-footer {
            padding: 20px 25px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ===== NOTIFICACIONES ===== */
        .notificacion {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1100;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
        }

        .notificacion.mostrar {
            transform: translateX(0);
            opacity: 1;
        }

        .notificacion-contenido {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .notificacion.success {
            border-left: 4px solid var(--success);
        }

        .notificacion.error {
            border-left: 4px solid var(--danger);
        }

        .notificacion.info {
            border-left: 4px solid var(--info);
        }

        .notificacion.warning {
            border-left: 4px solid var(--warning);
        }

        .notificacion-cerrar {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* ===== FILTROS ===== */
        .filtros {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filtro-select {
            padding: 12px 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            font-size: 15px;
            min-width: 200px;
        }

        /* ===== TABLA DE ITEMS DE PEDIDO ===== */
        .items-pedido {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .items-pedido th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 1px solid #e1e5e9;
        }

        .items-pedido td {
            padding: 12px;
            border-bottom: 1px solid #f1f1f1;
        }

        .items-pedido .item-cantidad {
            width: 100px;
        }

        .items-pedido .item-precio {
            width: 120px;
        }

        .items-pedido .item-subtotal {
            width: 120px;
            font-weight: 600;
        }

        .items-pedido .item-acciones {
            width: 80px;
            text-align: center;
        }

        .total-pedido {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* ===== PDF PREVIEW ===== */
        .pdf-preview {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
        }

        .pdf-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .pdf-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .pdf-info-section {
            flex: 1;
        }

        .pdf-info-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .pdf-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .pdf-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }

        .pdf-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .pdf-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 20px;
        }

        .pdf-footer {
            margin-top: 40px;
            text-align: center;
            color: var(--secondary);
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar { 
                width: 100%;
                position: static;
            }
            
            .header {
                flex-wrap: wrap;
                height: auto;
                padding: 15px 20px;
                gap: 15px;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .search-box { 
                width: 100%;
                min-width: auto;
            }
            
            .data-table { 
                font-size: 0.85rem;
            }
            
            .data-table th,
            .data-table td { 
                padding: 10px 8px;
            }

            .section-header {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .filtros {
                flex-direction: column;
            }

            .filtro-select {
                width: 100%;
            }

            .items-pedido {
                font-size: 0.85rem;
            }

            .pdf-info {
                flex-direction: column;
                gap: 20px;
            }

            .pagination-container {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .pagination {
                justify-content: center;
            }
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>
                    <i class="fas fa-warehouse"></i>
                    La Merced <span>Comestibles</span>
                </h1>
            </div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span>Administrador</span>
            </div>
            <a href="http://127.0.0.1:8000/inicio/" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Volver al Inicio
            </a>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <ul>
                        <li class="nav-item active" data-section="dashboard">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </li>
                        <li class="nav-item" data-section="productos">
                            <i class="fas fa-boxes"></i>
                            <span>Productos</span>
                        </li>
                        <li class="nav-item" data-section="categorias">
                            <i class="fas fa-tags"></i>
                            <span>Categorías</span>
                        </li>
                        <li class="nav-item" data-section="proveedores">
                            <i class="fas fa-truck"></i>
                            <span>Proveedores</span>
                        </li>
                        <li class="nav-item" data-section="pedidos">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Pedidos</span>
                        </li>
                        <li class="nav-item" data-section="vencimientos">
                            <i class="fas fa-calendar-times"></i>
                            <span>Vencimientos</span>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Content Area -->
            <main class="content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <h2><i class="fas fa-chart-line"></i> Dashboard de Stock</h2>
                    
                    <!-- Cards -->
                    <div class="dashboard-cards">
                        <div class="card card-primary">
                            <div class="card-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="card-info">
                                <h3>Total Productos</h3>
                                <p id="total-productos">0</p>
                            </div>
                        </div>
                        <div class="card card-success">
                            <div class="card-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Stock Óptimo</h3>
                                <p id="stock-optimo">0</p>
                            </div>
                        </div>
                        <div class="card card-info">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Stock Bajo</h3>
                                <p id="stock-bajo">0</p>
                            </div>
                        </div>
                        <div class="card card-danger">
                            <div class="card-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Sin Stock</h3>
                                <p id="sin-stock">0</p>
                            </div>
                        </div>
                        <div class="card card-warning">
                            <div class="card-icon">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                            <div class="card-info">
                                <h3>Próximos a Vencer</h3>
                                <p id="proximos-vencer">0</p>
                            </div>
                        </div>
                        <div class="card card-danger">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Vencidos</h3>
                                <p id="vencidos">0</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Productos Section -->
                <section id="productos" class="section">
                    <h2><i class="fas fa-boxes"></i> Gestión de Productos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar productos..." id="searchProductos">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>
                            <a href="{% url 'stock:crear_producto' %}" class="btn btn-primary me-2">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </a>
                            <a href="{% url 'stock:crear_categoria' %}" class="btn btn-success me-2">
                                <i class="fas fa-plus"></i> Nueva Categoría
                            </a>
                            <a href="{% url 'stock:crear_proveedor' %}" class="btn btn-info">
                                <i class="fas fa-plus"></i> Nuevo Proveedor
                            </a>
                        </div>
                    </div>

                    <!-- Filtros para productos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroProveedorProductos">
                            <option value="">Todos los proveedores</option>
                        </select>
                        <select class="filtro-select" id="filtroCategoriaProductos">
                            <option value="">Todas las categorías</option>
                        </select>
                        <select class="filtro-select" id="filtroEstadoProductos">
                            <option value="">Todos los estados</option>
                            <option value="optimo">Stock Óptimo</option>
                            <option value="bajo">Stock Bajo</option>
                            <option value="sin">Sin Stock</option>
                        </select>
                        <select class="filtro-select" id="filtroVencimientoProductos">
                            <option value="">Todos los vencimientos</option>
                            <option value="vencido">Vencidos</option>
                            <option value="proximo">Próximos a vencer</option>
                            <option value="ok">Vigentes</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Imagen</th>
                                    <th>Nombre</th>
                                    <th>Precio</th> 
                                    <th>Categoría</th>
                                    <th>Proveedor</th>
                                    <th>Stock</th>
                                    <th>Vencimiento</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productos-content">
                                <!-- Los productos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                        <!-- Paginación para productos -->
                        <div class="pagination-container" id="pagination-productos">
                            <div class="pagination-info" id="pagination-info-productos">
                                Mostrando 0 de 0 productos
                            </div>
                            <div class="pagination" id="pagination-buttons-productos">
                                <!-- Los botones de paginación se generarán aquí -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Categorías Section -->
                <section id="categorias" class="section">
                    <h2><i class="fas fa-tags"></i> Gestión de Categorías</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar categorías..." id="searchCategorias">
                            <i class="fas fa-search"></i>
                        </div>
                        <a href="{% url 'stock:crear_categoria' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Nueva Categoría
                        </a>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Productos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="categorias-content">
                                <!-- Las categorías se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Proveedores Section -->
                <section id="proveedores" class="section">
                    <h2><i class="fas fa-truck"></i> Gestión de Proveedores</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar proveedores..." id="searchProveedores">
                            <i class="fas fa-search"></i>
                        </div>
                        <a href="{% url 'stock:crear_proveedor' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Nuevo Proveedor
                        </a>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Contacto</th>
                                    <th>Teléfono</th>
                                    <th>Productos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="proveedores-content">
                                <!-- Los proveedores se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Pedidos Section -->
                <section id="pedidos" class="section">
                    <h2><i class="fas fa-clipboard-list"></i> Gestión de Pedidos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar pedidos..." id="searchPedidos">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="abrirModalPedido()">
                                <i class="fas fa-plus"></i>
                                Nuevo Pedido
                            </button>
                            <button class="btn btn-warning" onclick="descargarPDFPedidos()">
                                <i class="fas fa-file-pdf"></i>
                                Descargar PDF
                            </button>
                        </div>
                    </div>

                    <!-- Filtros para pedidos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroEstadoPedidos">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="confirmado">Confirmado</option>
                            <option value="preparando">En Preparación</option>
                            <option value="listo">Listo para Retirar</option>
                            <option value="entregado">Entregado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                        <select class="filtro-select" id="filtroFechaPedidos">
                            <option value="">Todas las fechas</option>
                            <option value="hoy">Hoy</option>
                            <option value="semana">Esta semana</option>
                            <option value="mes">Este mes</option>
                        </select>
                        <select class="filtro-select" id="filtroSucursalPedidos">
                            <option value="">Todas las sucursales</option>
                            <option value="Sucursal Centro">Sucursal Centro</option>
                            <option value="Sucursal Norte">Sucursal Norte</option>
                            <option value="Sucursal Sur">Sucursal Sur</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Sucursal</th>
                                    <th>Usuario</th>
                                    <th>Fecha Pedido</th>
                                    <th>Estado</th>
                                    <th>Código Retiro</th>
                                    <th>Productos</th>
                                    <th>Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-content">
                                <!-- Los pedidos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Vencimientos Section -->
                <section id="vencimientos" class="section">
                    <h2><i class="fas fa-calendar-times"></i> Control de Vencimientos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar productos..." id="searchVencimientos">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-warning" id="btnReporteVencimientos">
                            <i class="fas fa-file-pdf"></i>
                            Generar Reporte
                        </button>
                    </div>

                    <!-- Filtros para vencimientos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroEstadoVencimiento">
                            <option value="">Todos los estados</option>
                            <option value="vencido">Vencidos</option>
                            <option value="proximo">Próximos a vencer</option>
                            <option value="ok">Vigentes</option>
                        </select>
                        <select class="filtro-select" id="filtroDiasVencimiento">
                            <option value="">Todos los rangos</option>
                            <option value="7">Próximos 7 días</option>
                            <option value="15">Próximos 15 días</option>
                            <option value="30">Próximos 30 días</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Producto</th>
                                    <th>Categoría</th>
                                    <th>Stock</th>
                                    <th>Fecha Vencimiento</th>
                                    <th>Días Restantes</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="vencimientos-content">
                                <!-- Los productos con vencimiento se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Script JavaScript -->
    <script>
        // URLs base
        const API_PRODUCTOS = '/stock/api/productos/';
        const API_CATEGORIAS = '/stock/api/categorias/';
        const API_PROVEEDORES = '/stock/api/proveedores/';
        const API_PEDIDOS = '/stock/api/pedidos/';

        // Variables globales para los datos
        let productos = [];
        let categorias = [];
        let proveedores = [];
        let pedidos = [];
        let productosPedido = [];

        // Variables de paginación
        let productosPaginados = [];
        let productosPorPagina = 10;
        let paginaActualProductos = 1;
        let totalPaginasProductos = 1;

        // Variables para vencimientos
        let productosConVencimiento = [];
        let productosPorPaginaVencimientos = 10;
        let paginaActualVencimientos = 1;
        let totalPaginasVencimientos = 1;

        // Datos de ejemplo para pedidos
        const pedidosEjemplo = [
            {
                id: 1,
                sucursal: 'Sucursal Centro',
                usuario: 'Administrador',
                fecha_pedido: '2025-11-26 10:30',
                estado: 'pendiente',
                codigo_retiro: 'PED-001',
                productos_count: 3,
                total: 125.50
            },
            {
                id: 2,
                sucursal: 'Sucursal Norte',
                usuario: 'Vendedor 1',
                fecha_pedido: '2025-11-25 14:20',
                estado: 'confirmado',
                codigo_retiro: 'PED-002',
                productos_count: 5,
                total: 89.75
            },
            {
                id: 3,
                sucursal: 'Sucursal Sur',
                usuario: 'Vendedor 2',
                fecha_pedido: '2025-11-24 09:15',
                estado: 'entregado',
                codigo_retiro: 'PED-003',
                productos_count: 2,
                total: 45.20
            },
            {
                id: 4,
                sucursal: 'Sucursal Centro',
                usuario: 'Administrador',
                fecha_pedido: '2025-11-23 16:45',
                estado: 'preparando',
                codigo_retiro: 'PED-004',
                productos_count: 4,
                total: 210.80
            },
            {
                id: 5,
                sucursal: 'Sucursal Norte',
                usuario: 'Vendedor 1',
                fecha_pedido: '2025-11-22 11:20',
                estado: 'listo',
                codigo_retiro: 'PED-005',
                productos_count: 1,
                total: 35.90
            },
            {
                id: 6,
                sucursal: 'Sucursal Sur',
                usuario: 'Vendedor 2',
                fecha_pedido: '2025-11-21 08:30',
                estado: 'cancelado',
                codigo_retiro: 'PED-006',
                productos_count: 3,
                total: 78.40
            }
        ];

        // ===== FUNCIONES BÁSICAS =====
        function getCSRFToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }

        function mostrarMensaje(mensaje, tipo = 'info') {
            // Crear elemento de notificación
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion ${tipo}`;
            
            let icono = 'info-circle';
            if (tipo === 'success') icono = 'check-circle';
            if (tipo === 'error') icono = 'exclamation-circle';
            if (tipo === 'warning') icono = 'exclamation-triangle';
            
            notificacion.innerHTML = `
                <div class="notificacion-contenido">
                    <i class="fas fa-${icono}"></i>
                    <span>${mensaje}</span>
                </div>
                <button class="notificacion-cerrar">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => notificacion.classList.add('mostrar'), 100);
            
            setTimeout(() => {
                notificacion.classList.remove('mostrar');
                setTimeout(() => notificacion.remove(), 300);
            }, 5000);
            
            notificacion.querySelector('.notificacion-cerrar').addEventListener('click', function() {
                notificacion.classList.remove('mostrar');
                setTimeout(() => notificacion.remove(), 300);
            });
        }

        // ===== FUNCIONES DE CARGA DE DATOS =====
        async function fetchAPI(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCSRFToken(),
                    },
                    ...options
                });
                
                if (!response.ok) throw new Error(`Error ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error en fetchAPI:', error);
                throw error;
            }
        }

        async function cargarDatosReales() {
            try {
                console.log('🔄 Cargando datos...');
                
                productos = await fetchAPI(API_PRODUCTOS);
                categorias = await fetchAPI(API_CATEGORIAS);
                proveedores = await fetchAPI(API_PROVEEDORES);
                
                cargarProductos();
                cargarCategorias();
                cargarProveedores();
                cargarPedidos();
                cargarVencimientos();
                cargarDashboard();
                cargarFiltros();
                
            } catch (error) {
                console.error('❌ Error cargando datos:', error);
                mostrarMensaje('Error al cargar los datos', 'error');
            }
        }

        // ===== FUNCIONES PARA VENCIMIENTOS =====
        function cargarVencimientos() {
            filtrarVencimientos(); // Cargar todos los productos con vencimiento inicialmente
        }

        function filtrarVencimientos() {
            const tbody = document.getElementById('vencimientos-content');
            if (!tbody) return;
            
            const termino = document.getElementById('searchVencimientos').value.toLowerCase();
            const filtroEstado = document.getElementById('filtroEstadoVencimiento').value;
            const filtroDias = document.getElementById('filtroDiasVencimiento').value;
            
            // Filtrar productos que tienen fecha de vencimiento
            const productosConFechaVencimiento = productos.filter(p => p.fechavencimiento);
            
            // Aplicar filtros
            const productosFiltrados = productosConFechaVencimiento.filter(producto => {
                const coincideTermino = 
                    producto.nombre.toLowerCase().includes(termino) ||
                    producto.categoria.toLowerCase().includes(termino);
                
                // Calcular días restantes
                const fechaVenc = new Date(producto.fechavencimiento);
                const hoy = new Date();
                const diffTime = fechaVenc - hoy;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Filtro por estado
                let coincideEstado = true;
                if (filtroEstado === 'vencido') {
                    coincideEstado = diffDays < 0;
                } else if (filtroEstado === 'proximo') {
                    coincideEstado = diffDays >= 0 && diffDays <= 30;
                } else if (filtroEstado === 'ok') {
                    coincideEstado = diffDays > 30;
                }
                
                // Filtro por días
                let coincideDias = true;
                if (filtroDias) {
                    const dias = parseInt(filtroDias);
                    coincideDias = diffDays >= 0 && diffDays <= dias;
                }
                
                return coincideTermino && coincideEstado && coincideDias;
            });
            
            // Ordenar por fecha de vencimiento (más próximos primero)
            productosFiltrados.sort((a, b) => {
                const fechaA = new Date(a.fechavencimiento);
                const fechaB = new Date(b.fechavencimiento);
                return fechaA - fechaB;
            });
            
            // Paginar resultados
            const productosPagina = paginarVencimientos(productosFiltrados);
            
            // Mostrar productos filtrados
            tbody.innerHTML = '';
            
            if (productosPagina.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron productos</h3>
                            <p>Intente con otros criterios de búsqueda</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            productosPagina.forEach(producto => {
                const fechaVenc = new Date(producto.fechavencimiento);
                const hoy = new Date();
                const diffTime = fechaVenc - hoy;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                // Determinar estado de vencimiento
                let estadoVencimiento = '';
                let estadoClass = '';
                
                if (diffDays < 0) {
                    estadoVencimiento = 'Vencido';
                    estadoClass = 'vencimiento-critico';
                } else if (diffDays <= 7) {
                    estadoVencimiento = 'Crítico';
                    estadoClass = 'vencimiento-critico';
                } else if (diffDays <= 15) {
                    estadoVencimiento = 'Próximo';
                    estadoClass = 'vencimiento-proximo';
                } else if (diffDays <= 30) {
                    estadoVencimiento = 'Alerta';
                    estadoClass = 'vencimiento-proximo';
                } else {
                    estadoVencimiento = 'Vigente';
                    estadoClass = 'vencimiento-ok';
                }
                
                // Determinar clase para días restantes
                let diasClass = '';
                if (diffDays < 0) {
                    diasClass = 'stock-critico';
                } else if (diffDays <= 7) {
                    diasClass = 'stock-bajo';
                } else if (diffDays <= 30) {
                    diasClass = 'stock-optimo';
                }
                
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${producto.id}</td>
                    <td>${producto.nombre}</td>
                    <td>${producto.categoria}</td>
                    <td>${producto.stock}</td>
                    <td>${fechaVenc.toLocaleDateString('es-ES')}</td>
                    <td class="${diasClass}">${diffDays} días</td>
                    <td>
                        <span class="${estadoClass}">${estadoVencimiento}</span>
                    </td>
                    <td>
                        <a href="/stock/productos/${producto.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProducto(${producto.id}, '${producto.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${producto.stock > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
            
            // Actualizar paginación
            actualizarPaginacionVencimientos();
        }

        function paginarVencimientos(productosFiltrados) {
            productosConVencimiento = productosFiltrados;
            totalPaginasVencimientos = Math.ceil(productosConVencimiento.length / productosPorPaginaVencimientos);
            
            // Asegurar que la página actual sea válida
            if (paginaActualVencimientos > totalPaginasVencimientos) {
                paginaActualVencimientos = totalPaginasVencimientos || 1;
            }
            
            // Obtener productos para la página actual
            const inicio = (paginaActualVencimientos - 1) * productosPorPaginaVencimientos;
            const fin = inicio + productosPorPaginaVencimientos;
            const productosPagina = productosConVencimiento.slice(inicio, fin);
            
            return productosPagina;
        }

        function actualizarPaginacionVencimientos() {
            const paginationInfo = document.getElementById('pagination-info-vencimientos');
            const paginationButtons = document.getElementById('pagination-buttons-vencimientos');
            
            if (!paginationInfo || !paginationButtons) return;
            
            // Actualizar información de paginación
            const inicio = (paginaActualVencimientos - 1) * productosPorPaginaVencimientos + 1;
            const fin = Math.min(paginaActualVencimientos * productosPorPaginaVencimientos, productosConVencimiento.length);
            const total = productosConVencimiento.length;
            
            paginationInfo.textContent = `Mostrando ${inicio}-${fin} de ${total} productos`;
            
            // Generar botones de paginación (similar a productos)
            paginationButtons.innerHTML = '';
            
            // Botón anterior
            const prevButton = document.createElement('button');
            prevButton.className = `pagination-btn ${paginaActualVencimientos === 1 ? 'disabled' : ''}`;
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = paginaActualVencimientos === 1;
            prevButton.addEventListener('click', () => {
                if (paginaActualVencimientos > 1) {
                    paginaActualVencimientos--;
                    filtrarVencimientos();
                }
            });
            paginationButtons.appendChild(prevButton);
            
            // Botones de páginas
            const maxButtons = 5;
            let startPage = Math.max(1, paginaActualVencimientos - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPaginasVencimientos, startPage + maxButtons - 1);
            
            // Ajustar si estamos cerca del final
            if (endPage - startPage + 1 < maxButtons) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }
            
            // Botón primera página
            if (startPage > 1) {
                const firstButton = document.createElement('button');
                firstButton.className = 'pagination-btn';
                firstButton.textContent = '1';
                firstButton.addEventListener('click', () => {
                    paginaActualVencimientos = 1;
                    filtrarVencimientos();
                });
                paginationButtons.appendChild(firstButton);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-ellipsis';
                    ellipsis.textContent = '...';
                    paginationButtons.appendChild(ellipsis);
                }
            }
            
            // Botones de páginas numeradas
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === paginaActualVencimientos ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    paginaActualVencimientos = i;
                    filtrarVencimientos();
                });
                paginationButtons.appendChild(pageButton);
            }
            
            // Botón última página
            if (endPage < totalPaginasVencimientos) {
                if (endPage < totalPaginasVencimientos - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-ellipsis';
                    ellipsis.textContent = '...';
                    paginationButtons.appendChild(ellipsis);
                }
                
                const lastButton = document.createElement('button');
                lastButton.className = 'pagination-btn';
                lastButton.textContent = totalPaginasVencimientos;
                lastButton.addEventListener('click', () => {
                    paginaActualVencimientos = totalPaginasVencimientos;
                    filtrarVencimientos();
                });
                paginationButtons.appendChild(lastButton);
            }
            
            // Botón siguiente
            const nextButton = document.createElement('button');
            nextButton.className = `pagination-btn ${paginaActualVencimientos === totalPaginasVencimientos ? 'disabled' : ''}`;
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = paginaActualVencimientos === totalPaginasVencimientos;
            nextButton.addEventListener('click', () => {
                if (paginaActualVencimientos < totalPaginasVencimientos) {
                    paginaActualVencimientos++;
                    filtrarVencimientos();
                }
            });
            paginationButtons.appendChild(nextButton);
        }

        function generarReporteVencimientos() {
            try {
                mostrarMensaje('Generando reporte de vencimientos...', 'info');
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configuración del documento
                doc.setFont('helvetica');
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 40);
                
                // Título
                doc.text('REPORTE DE VENCIMIENTOS - LA MERCED COMESTIBLES', 105, 20, { align: 'center' });
                
                // Fecha de generación
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generado el: ${new Date().toLocaleDateString('es-ES')}`, 105, 30, { align: 'center' });
                
                // Información de la empresa
                doc.setFontSize(12);
                doc.setTextColor(60, 60, 60);
                doc.text('La Merced Comestibles', 20, 45);
                doc.text('Sistema de Gestión de Stock', 20, 52);
                
                // Resumen de vencimientos
                const hoy = new Date();
                let vencidos = 0;
                let criticos = 0;
                let proximos = 0;
                let alerta = 0;
                
                productos.forEach(producto => {
                    if (producto.fechavencimiento) {
                        const fechaVenc = new Date(producto.fechavencimiento);
                        const diffTime = fechaVenc - hoy;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (diffDays < 0) {
                            vencidos++;
                        } else if (diffDays <= 7) {
                            criticos++;
                        } else if (diffDays <= 15) {
                            proximos++;
                        } else if (diffDays <= 30) {
                            alerta++;
                        }
                    }
                });
                
                doc.text('Resumen de Vencimientos:', 20, 70);
                doc.text(`Vencidos: ${vencidos}`, 30, 80);
                doc.text(`Críticos (≤7 días): ${criticos}`, 30, 87);
                doc.text(`Próximos (8-15 días): ${proximos}`, 30, 94);
                doc.text(`En Alerta (16-30 días): ${alerta}`, 30, 101);
                
                // Tabla de productos
                let yPosition = 120;
                
                // Encabezado de la tabla
                doc.setFillColor(102, 126, 234);
                doc.rect(20, yPosition, 170, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.text('Producto', 25, yPosition + 7);
                doc.text('Categoría', 80, yPosition + 7);
                doc.text('Stock', 130, yPosition + 7);
                doc.text('Vence', 150, yPosition + 7);
                doc.text('Días', 170, yPosition + 7);
                
                yPosition += 15;
                
                // Obtener productos filtrados actuales
                const termino = document.getElementById('searchVencimientos').value.toLowerCase();
                const filtroEstado = document.getElementById('filtroEstadoVencimiento').value;
                const filtroDias = document.getElementById('filtroDiasVencimiento').value;
                
                const productosConFechaVencimiento = productos.filter(p => p.fechavencimiento);
                const productosFiltrados = productosConFechaVencimiento.filter(producto => {
                    const coincideTermino = 
                        producto.nombre.toLowerCase().includes(termino) ||
                        producto.categoria.toLowerCase().includes(termino);
                    
                    // Calcular días restantes
                    const fechaVenc = new Date(producto.fechavencimiento);
                    const hoy = new Date();
                    const diffTime = fechaVenc - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    // Filtro por estado
                    let coincideEstado = true;
                    if (filtroEstado === 'vencido') {
                        coincideEstado = diffDays < 0;
                    } else if (filtroEstado === 'proximo') {
                        coincideEstado = diffDays >= 0 && diffDays <= 30;
                    } else if (filtroEstado === 'ok') {
                        coincideEstado = diffDays > 30;
                    }
                    
                    // Filtro por días
                    let coincideDias = true;
                    if (filtroDias) {
                        const dias = parseInt(filtroDias);
                        coincideDias = diffDays >= 0 && diffDays <= dias;
                    }
                    
                    return coincideTermino && coincideEstado && coincideDias;
                });
                
                // Ordenar por fecha de vencimiento
                productosFiltrados.sort((a, b) => {
                    const fechaA = new Date(a.fechavencimiento);
                    const fechaB = new Date(b.fechavencimiento);
                    return fechaA - fechaB;
                });
                
                // Datos de los productos
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(9);
                
                productosFiltrados.forEach((producto, index) => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Fondo alternado para filas
                    if (index % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                        doc.rect(20, yPosition - 5, 170, 8, 'F');
                    }
                    
                    const fechaVenc = new Date(producto.fechavencimiento);
                    const hoy = new Date();
                    const diffTime = fechaVenc - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    // Color según días restantes
                    if (diffDays < 0) {
                        doc.setTextColor(220, 53, 69); // Rojo para vencidos
                    } else if (diffDays <= 7) {
                        doc.setTextColor(255, 193, 7); // Amarillo para críticos
                    } else if (diffDays <= 30) {
                        doc.setTextColor(23, 162, 184); // Azul para alerta
                    } else {
                        doc.setTextColor(0, 0, 0); // Negro para normales
                    }
                    
                    doc.text(producto.nombre.substring(0, 25), 25, yPosition);
                    doc.text(producto.categoria.substring(0, 15), 80, yPosition);
                    doc.text(producto.stock.toString(), 130, yPosition);
                    doc.text(fechaVenc.toLocaleDateString('es-ES').substring(0, 10), 150, yPosition);
                    doc.text(diffDays.toString(), 170, yPosition);
                    
                    yPosition += 10;
                });
                
                // Pie de página
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Sistema de Gestión de Stock - La Merced Comestibles', 105, 290, { align: 'center' });
                
                // Guardar el PDF
                doc.save(`vencimientos_${new Date().toISOString().split('T')[0]}.pdf`);
                
                mostrarMensaje('Reporte de vencimientos generado exitosamente', 'success');
                
            } catch (error) {
                console.error('Error generando reporte de vencimientos:', error);
                mostrarMensaje('Error al generar el reporte de vencimientos', 'error');
            }
        }

        // ===== FUNCIONES DE PAGINACIÓN PARA PRODUCTOS =====
        function paginarProductos(productosFiltrados) {
            productosPaginados = productosFiltrados;
            totalPaginasProductos = Math.ceil(productosPaginados.length / productosPorPagina);
            
            // Asegurar que la página actual sea válida
            if (paginaActualProductos > totalPaginasProductos) {
                paginaActualProductos = totalPaginasProductos || 1;
            }
            
            // Obtener productos para la página actual
            const inicio = (paginaActualProductos - 1) * productosPorPagina;
            const fin = inicio + productosPorPagina;
            const productosPagina = productosPaginados.slice(inicio, fin);
            
            return productosPagina;
        }

        function actualizarPaginacionProductos() {
            const paginationInfo = document.getElementById('pagination-info-productos');
            const paginationButtons = document.getElementById('pagination-buttons-productos');
            
            if (!paginationInfo || !paginationButtons) return;
            
            // Actualizar información de paginación
            const inicio = (paginaActualProductos - 1) * productosPorPagina + 1;
            const fin = Math.min(paginaActualProductos * productosPorPagina, productosPaginados.length);
            const total = productosPaginados.length;
            
            paginationInfo.textContent = `Mostrando ${inicio}-${fin} de ${total} productos`;
            
            // Generar botones de paginación
            paginationButtons.innerHTML = '';
            
            // Botón anterior
            const prevButton = document.createElement('button');
            prevButton.className = `pagination-btn ${paginaActualProductos === 1 ? 'disabled' : ''}`;
            prevButton.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevButton.disabled = paginaActualProductos === 1;
            prevButton.addEventListener('click', () => {
                if (paginaActualProductos > 1) {
                    paginaActualProductos--;
                    filtrarProductos();
                }
            });
            paginationButtons.appendChild(prevButton);
            
            // Botones de páginas
            const maxButtons = 5;
            let startPage = Math.max(1, paginaActualProductos - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPaginasProductos, startPage + maxButtons - 1);
            
            // Ajustar si estamos cerca del final
            if (endPage - startPage + 1 < maxButtons) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }
            
            // Botón primera página
            if (startPage > 1) {
                const firstButton = document.createElement('button');
                firstButton.className = 'pagination-btn';
                firstButton.textContent = '1';
                firstButton.addEventListener('click', () => {
                    paginaActualProductos = 1;
                    filtrarProductos();
                });
                paginationButtons.appendChild(firstButton);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-ellipsis';
                    ellipsis.textContent = '...';
                    paginationButtons.appendChild(ellipsis);
                }
            }
            
            // Botones de páginas numeradas
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === paginaActualProductos ? 'active' : ''}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    paginaActualProductos = i;
                    filtrarProductos();
                });
                paginationButtons.appendChild(pageButton);
            }
            
            // Botón última página
            if (endPage < totalPaginasProductos) {
                if (endPage < totalPaginasProductos - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-ellipsis';
                    ellipsis.textContent = '...';
                    paginationButtons.appendChild(ellipsis);
                }
                
                const lastButton = document.createElement('button');
                lastButton.className = 'pagination-btn';
                lastButton.textContent = totalPaginasProductos;
                lastButton.addEventListener('click', () => {
                    paginaActualProductos = totalPaginasProductos;
                    filtrarProductos();
                });
                paginationButtons.appendChild(lastButton);
            }
            
            // Botón siguiente
            const nextButton = document.createElement('button');
            nextButton.className = `pagination-btn ${paginaActualProductos === totalPaginasProductos ? 'disabled' : ''}`;
            nextButton.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextButton.disabled = paginaActualProductos === totalPaginasProductos;
            nextButton.addEventListener('click', () => {
                if (paginaActualProductos < totalPaginasProductos) {
                    paginaActualProductos++;
                    filtrarProductos();
                }
            });
            paginationButtons.appendChild(nextButton);
        }

        // ===== FUNCIONES PARA PRODUCTOS =====
        function cargarProductos() {
            filtrarProductos(); // Cargar todos los productos inicialmente
        }

        function filtrarProductos() {
            const tbody = document.getElementById('productos-content');
            if (!tbody) return;
            
            const termino = document.getElementById('searchProductos').value.toLowerCase();
            const filtroProveedor = document.getElementById('filtroProveedorProductos')?.value || '';
            const filtroCategoria = document.getElementById('filtroCategoriaProductos')?.value || '';
            const filtroEstado = document.getElementById('filtroEstadoProductos')?.value || '';
            const filtroVencimiento = document.getElementById('filtroVencimientoProductos')?.value || '';
            
            // Filtrar productos
            const productosFiltrados = productos.filter(p => {
                const coincideTermino = p.nombre.toLowerCase().includes(termino) || 
                    p.categoria.toLowerCase().includes(termino);
                
                const coincideProveedor = !filtroProveedor || p.proveedor_id == filtroProveedor;
                const coincideCategoria = !filtroCategoria || p.categoria_id == filtroCategoria;
                
                let coincideEstado = true;
                if (filtroEstado === 'optimo') {
                    coincideEstado = p.stock > 10;
                } else if (filtroEstado === 'bajo') {
                    coincideEstado = p.stock <= 10 && p.stock > 0;
                } else if (filtroEstado === 'sin') {
                    coincideEstado = p.stock === 0;
                }
                
                // Filtro por vencimiento
                let coincideVencimiento = true;
                if (filtroVencimiento && p.fechavencimiento) {
                    const fechaVenc = new Date(p.fechavencimiento);
                    const hoy = new Date();
                    const diffTime = fechaVenc - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (filtroVencimiento === 'vencido') {
                        coincideVencimiento = diffDays < 0;
                    } else if (filtroVencimiento === 'proximo') {
                        coincideVencimiento = diffDays >= 0 && diffDays <= 7;
                    } else if (filtroVencimiento === 'ok') {
                        coincideVencimiento = diffDays > 7;
                    }
                } else if (filtroVencimiento && !p.fechavencimiento) {
                    // Si no tiene fecha de vencimiento y se filtra por vencimiento, excluir
                    coincideVencimiento = false;
                }
                
                return coincideTermino && coincideProveedor && coincideCategoria && coincideEstado && coincideVencimiento;
            });
            
            // Paginar productos filtrados
            const productosPagina = paginarProductos(productosFiltrados);
            
            // Mostrar productos filtrados
            tbody.innerHTML = '';
            
            if (productosPagina.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron productos</h3>
                        </td>
                    </tr>
                `;
            } else {
                productosPagina.forEach(producto => {
                    const estadoStock = producto.stock === 0 ? 
                        '<span class="badge badge-danger">Sin Stock</span>' : 
                        producto.stock <= 10 ? 
                        '<span class="badge badge-warning">Stock Bajo</span>' : 
                        '<span class="badge badge-success">Óptimo</span>';
                    
                    // Formatear fecha de vencimiento
                    let fechaVencimiento = 'No definida';
                    let estadoVencimiento = '';
                    
                    if (producto.fechavencimiento) {
                        const fechaVenc = new Date(producto.fechavencimiento);
                        const hoy = new Date();
                        const diffTime = fechaVenc - hoy;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        fechaVencimiento = fechaVenc.toLocaleDateString('es-ES');
                        
                        if (diffDays < 0) {
                            estadoVencimiento = '<span class="vencimiento-critico">Vencido</span>';
                        } else if (diffDays <= 7) {
                            estadoVencimiento = '<span class="vencimiento-proximo">Próximo</span>';
                        } else if (diffDays <= 30) {
                            estadoVencimiento = '<span class="vencimiento-ok">Vigente</span>';
                        } else {
                            estadoVencimiento = '<span class="vencimiento-lejano">Lejano</span>';
                        }
                    }
                    
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                        <td>${producto.id}</td>
                        <td>
                            <img src="${producto.imagen || '/static/images/default-product.png'}" alt="${producto.nombre}" class="product-image">
                        </td>
                        <td>${producto.nombre}</td>
                        <td>$${producto.precio?.toFixed(2) || '0.00'}</td>
                        <td>${producto.categoria}</td>
                        <td>${producto.proveedor}</td>
                        <td>${producto.stock}</td>
                        <td>
                            ${fechaVencimiento}
                            ${estadoVencimiento ? '<br>' + estadoVencimiento : ''}
                        </td>
                        <td>${estadoStock}</td>
                        <td>
                            <a href="/stock/productos/${producto.id}/editar/" class="btn-icon" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button class="btn-icon delete" onclick="eliminarProducto(${producto.id}, '${producto.nombre.replace(/'/g, "\\'")}')" 
                                    title="Eliminar" ${producto.stock > 0 ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(fila);
                });
            }
            
            // Actualizar paginación
            actualizarPaginacionProductos();
        }

        // ===== FUNCIONES PARA PEDIDOS =====
        function cargarPedidos() {
            filtrarPedidos(); // Cargar todos los pedidos inicialmente
        }

        function filtrarPedidos() {
            const tbody = document.getElementById('pedidos-content');
            if (!tbody) return;
            
            const termino = document.getElementById('searchPedidos').value.toLowerCase();
            const filtroEstado = document.getElementById('filtroEstadoPedidos').value;
            const filtroFecha = document.getElementById('filtroFechaPedidos').value;
            const filtroSucursal = document.getElementById('filtroSucursalPedidos').value;
            
            // Filtrar pedidos
            const pedidosFiltrados = pedidosEjemplo.filter(pedido => {
                // Filtro por término de búsqueda
                const coincideTermino = 
                    pedido.sucursal.toLowerCase().includes(termino) ||
                    pedido.usuario.toLowerCase().includes(termino) ||
                    pedido.codigo_retiro.toLowerCase().includes(termino) ||
                    pedido.id.toString().includes(termino);
                
                // Filtro por estado
                const coincideEstado = !filtroEstado || pedido.estado === filtroEstado;
                
                // Filtro por sucursal
                const coincideSucursal = !filtroSucursal || pedido.sucursal === filtroSucursal;
                
                // Filtro por fecha
                let coincideFecha = true;
                if (filtroFecha) {
                    const fechaPedido = new Date(pedido.fecha_pedido);
                    const hoy = new Date();
                    
                    switch (filtroFecha) {
                        case 'hoy':
                            coincideFecha = fechaPedido.toDateString() === hoy.toDateString();
                            break;
                        case 'semana':
                            const inicioSemana = new Date(hoy);
                            inicioSemana.setDate(hoy.getDate() - hoy.getDay());
                            coincideFecha = fechaPedido >= inicioSemana;
                            break;
                        case 'mes':
                            coincideFecha = fechaPedido.getMonth() === hoy.getMonth() && 
                                          fechaPedido.getFullYear() === hoy.getFullYear();
                            break;
                    }
                }
                
                return coincideTermino && coincideEstado && coincideFecha && coincideSucursal;
            });
            
            // Mostrar pedidos filtrados
            tbody.innerHTML = '';
            
            if (pedidosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="empty-state">
                            <i class="fas fa-clipboard-list"></i>
                            <h3>No se encontraron pedidos</h3>
                            <p>Intente con otros criterios de búsqueda</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            pedidosFiltrados.forEach(pedido => {
                const estadoClass = `estado-${pedido.estado}`;
                const estadoText = {
                    'pendiente': 'Pendiente',
                    'confirmado': 'Confirmado',
                    'preparando': 'En Preparación',
                    'listo': 'Listo para Retirar',
                    'entregado': 'Entregado',
                    'cancelado': 'Cancelado'
                }[pedido.estado] || pedido.estado;
                
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${pedido.id}</td>
                    <td>${pedido.sucursal}</td>
                    <td>${pedido.usuario}</td>
                    <td>${pedido.fecha_pedido}</td>
                    <td>
                        <span class="badge-pedido ${estadoClass}">${estadoText}</span>
                    </td>
                    <td>${pedido.codigo_retiro}</td>
                    <td>${pedido.productos_count} productos</td>
                    <td>$${pedido.total.toFixed(2)}</td>
                    <td>
                        <button class="btn-icon" title="Editar" onclick="editarPedido(${pedido.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-icon delete" title="Eliminar" onclick="eliminarPedido(${pedido.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn-icon" title="Descargar PDF" onclick="descargarPDFPedido(${pedido.id})">
                            <i class="fas fa-file-pdf"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES PARA CATEGORÍAS =====
        function cargarCategorias() {
            const tbody = document.getElementById('categorias-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (categorias.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-tags"></i>
                            <h3>No hay categorías</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            categorias.forEach(categoria => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${categoria.id}</td>
                    <td>${categoria.nombre}</td>
                    <td>${categoria.descripcion}</td>
                    <td>${categoria.productos_count}</td>
                    <td>
                        <a href="/stock/categorias/${categoria.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarCategoria(${categoria.id}, '${categoria.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${categoria.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES PARA PROVEEDORES =====
        function cargarProveedores() {
            const tbody = document.getElementById('proveedores-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (proveedores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>No hay proveedores</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            proveedores.forEach(proveedor => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${proveedor.id}</td>
                    <td>${proveedor.nombre}</td>
                    <td>${proveedor.telefono}</td>
                    <td>${proveedor.email}</td>
                    <td>${proveedor.productos_count} productos</td>
                    <td>
                        <a href="/stock/proveedores/${proveedor.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProveedor(${proveedor.id}, '${proveedor.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${proveedor.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES DE ELIMINACIÓN =====
        async function eliminarProducto(id, nombre) {
            if (!confirm(`¿Eliminar producto "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/productos/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Producto "${nombre}" eliminado`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        async function eliminarCategoria(id, nombre) {
            if (!confirm(`¿Eliminar categoría "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/categorias/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Categoría "${nombre}" eliminada`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        async function eliminarProveedor(id, nombre) {
            if (!confirm(`¿Eliminar proveedor "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/proveedores/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Proveedor "${nombre}" eliminado`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        // ===== FUNCIONES AUXILIARES =====
        function cargarFiltros() {
            const filtroProveedor = document.getElementById('filtroProveedorProductos');
            if (filtroProveedor) {
                filtroProveedor.innerHTML = '<option value="">Todos los proveedores</option>';
                proveedores.forEach(proveedor => {
                    filtroProveedor.innerHTML += `<option value="${proveedor.id}">${proveedor.nombre}</option>`;
                });
            }

            const filtroCategoria = document.getElementById('filtroCategoriaProductos');
            if (filtroCategoria) {
                filtroCategoria.innerHTML = '<option value="">Todas las categorías</option>';
                categorias.forEach(categoria => {
                    filtroCategoria.innerHTML += `<option value="${categoria.id}">${categoria.nombre}</option>`;
                });
            }
        }

        function cargarDashboard() {
            if (!productos.length) return;

            const totalProductos = productos.length;
            const stockOptimo = productos.filter(p => p.stock > 10).length;
            const stockBajo = productos.filter(p => p.stock <= 10 && p.stock > 0).length;
            const sinStock = productos.filter(p => p.stock === 0).length;
            
            // Calcular productos vencidos y próximos a vencer
            const hoy = new Date();
            let vencidos = 0;
            let proximosVencer = 0;
            
            productos.forEach(producto => {
                if (producto.fechavencimiento) {
                    const fechaVenc = new Date(producto.fechavencimiento);
                    const diffTime = fechaVenc - hoy;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        vencidos++;
                    } else if (diffDays <= 7) {
                        proximosVencer++;
                    }
                }
            });
            
            document.getElementById('total-productos').textContent = totalProductos;
            document.getElementById('stock-optimo').textContent = stockOptimo;
            document.getElementById('stock-bajo').textContent = stockBajo;
            document.getElementById('sin-stock').textContent = sinStock;
            document.getElementById('vencidos').textContent = vencidos;
            document.getElementById('proximos-vencer').textContent = proximosVencer;
        }

        // ===== FUNCIONES DE FILTRADO =====
        function filtrarCategorias() {
            const termino = document.getElementById('searchCategorias').value.toLowerCase();
            const categoriasFiltradas = categorias.filter(cat => 
                cat.nombre.toLowerCase().includes(termino) || 
                (cat.descripcion && cat.descripcion.toLowerCase().includes(termino))
            );
            
            const tbody = document.getElementById('categorias-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (categoriasFiltradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron categorías</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            categoriasFiltradas.forEach(categoria => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${categoria.id}</td>
                    <td>${categoria.nombre}</td>
                    <td>${categoria.descripcion}</td>
                    <td>${categoria.productos_count}</td>
                    <td>
                        <a href="/stock/categorias/${categoria.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarCategoria(${categoria.id}, '${categoria.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${categoria.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        function filtrarProveedores() {
            const termino = document.getElementById('searchProveedores').value.toLowerCase();
            const proveedoresFiltrados = proveedores.filter(prov => 
                prov.nombre.toLowerCase().includes(termino) || 
                prov.telefono.toLowerCase().includes(termino) ||
                prov.email.toLowerCase().includes(termino)
            );
            
            const tbody = document.getElementById('proveedores-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (proveedoresFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron proveedores</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            proveedoresFiltrados.forEach(proveedor => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${proveedor.id}</td>
                    <td>${proveedor.nombre}</td>
                    <td>${proveedor.telefono}</td>
                    <td>${proveedor.email}</td>
                    <td>${proveedor.productos_count} productos</td>
                    <td>
                        <a href="/stock/proveedores/${proveedor.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProveedor(${proveedor.id}, '${proveedor.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${proveedor.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES DE FILTRADO PARA PEDIDOS =====
        function configurarFiltrosPedidos() {
            // Búsqueda en tiempo real
            document.getElementById('searchPedidos').addEventListener('input', filtrarPedidos);
            
            // Filtros por select
            document.getElementById('filtroEstadoPedidos').addEventListener('change', filtrarPedidos);
            document.getElementById('filtroFechaPedidos').addEventListener('change', filtrarPedidos);
            document.getElementById('filtroSucursalPedidos').addEventListener('change', filtrarPedidos);
        }

        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inicializando Gestión de Stock...');
            
            // Cargar datos
            cargarDatosReales();
            
            // Configurar búsquedas y filtros
            document.getElementById('searchProductos')?.addEventListener('input', function() {
                paginaActualProductos = 1; // Resetear a primera página al buscar
                filtrarProductos();
            });
            document.getElementById('searchCategorias')?.addEventListener('input', filtrarCategorias);
            document.getElementById('searchProveedores')?.addEventListener('input', filtrarProveedores);
            document.getElementById('searchVencimientos')?.addEventListener('input', function() {
                paginaActualVencimientos = 1; // Resetear a primera página al buscar
                filtrarVencimientos();
            });
            
            // Configurar filtros de productos
            document.getElementById('filtroProveedorProductos')?.addEventListener('change', function() {
                paginaActualProductos = 1; // Resetear a primera página al filtrar
                filtrarProductos();
            });
            document.getElementById('filtroCategoriaProductos')?.addEventListener('change', function() {
                paginaActualProductos = 1; // Resetear a primera página al filtrar
                filtrarProductos();
            });
            document.getElementById('filtroEstadoProductos')?.addEventListener('change', function() {
                paginaActualProductos = 1; // Resetear a primera página al filtrar
                filtrarProductos();
            });
            document.getElementById('filtroVencimientoProductos')?.addEventListener('change', function() {
                paginaActualProductos = 1; // Resetear a primera página al filtrar
                filtrarProductos();
            });
            
            // Configurar filtros de vencimientos
            document.getElementById('filtroEstadoVencimiento')?.addEventListener('change', function() {
                paginaActualVencimientos = 1; // Resetear a primera página al filtrar
                filtrarVencimientos();
            });
            document.getElementById('filtroDiasVencimiento')?.addEventListener('change', function() {
                paginaActualVencimientos = 1; // Resetear a primera página al filtrar
                filtrarVencimientos();
            });
            
            // Configurar filtros de pedidos
            configurarFiltrosPedidos();

            // Configurar botón de reporte de vencimientos
            document.getElementById('btnReporteVencimientos')?.addEventListener('click', generarReporteVencimientos);

            // Configurar navegación
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                    
                    this.classList.add('active');
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId)?.classList.add('active');
                });
            });

            console.log('✅ Gestión de Stock inicializada');
        });

        // ===== FUNCIONES PARA PEDIDOS (resto del código) =====
        // ... (el resto del código para pedidos, PDFs, etc. permanece igual)
    </script>
</body>
</html>