<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Stock - La Merced Comestibles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ===== RESET Y BASE ===== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Roboto', sans-serif; 
        }

        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --bg: #f5f6fa;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(80px);
            pointer-events: none;
            z-index: 0;
        }

        body::before {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, #a8d5e2 0%, transparent 70%);
            top: -150px;
            left: -150px;
            animation: float 20s ease-in-out infinite;
        }

        body::after {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #e3a8e4 0%, transparent 70%);
            bottom: -200px;
            right: -200px;
            animation: float 25s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }

        /* ===== CONTAINER ===== */
        .container { 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            height: 80px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            border-bottom: 3px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo h1 { 
            display: flex; 
            align-items: center; 
            font-size: 1.5rem; 
            font-weight: 700;
            color: var(--dark);
            gap: 12px;
        }

        .logo h1 i {
            color: var(--primary);
            font-size: 2rem;
        }

        .logo span { 
            color: var(--secondary);
            font-weight: 400;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--dark);
        }

        .user-info i {
            color: var(--primary);
            font-size: 2rem;
        }

        .back-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--secondary) 0%, #5a6268 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            border: none;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content { 
            display: flex; 
            flex: 1;
            padding: 20px;
            gap: 20px;
        }

        /* ===== SIDEBAR ===== */
        .sidebar { 
            width: 260px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .nav-menu ul { 
            list-style: none;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 25px;
            cursor: pointer;
            color: var(--dark);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 4px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
            border-left-color: var(--primary);
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.15) 0%, transparent 100%);
            border-left-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        .nav-item i {
            font-size: 1.5rem;
        }

        /* ===== CONTENT ===== */
        .content { 
            flex: 1;
            overflow: auto;
        }

        .section { 
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active { 
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            margin: 0 0 25px;
            color: var(--dark);
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .section h2 i {
            color: var(--primary);
        }

        /* ===== DASHBOARD CARDS ===== */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            display: flex;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            gap: 20px;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 5px solid;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-primary { border-color: var(--primary); }
        .card-success { border-color: var(--success); }
        .card-info { border-color: var(--info); }
        .card-danger { border-color: var(--danger); }
        .card-warning { border-color: var(--warning); }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .card-primary .card-icon {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .card-success .card-icon {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .card-info .card-icon {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .card-danger .card-icon {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .card-warning .card-icon {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: var(--dark);
        }

        .card-info h3 { 
            font-size: 1rem;
            color: var(--secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .card-info p { 
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin: 0;
        }

        /* ===== SECTION HEADER ===== */
        .section-header { 
            display: flex;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .search-box { 
            position: relative;
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            padding: 0 20px;
            box-shadow: var(--shadow);
            min-width: 300px;
        }

        .search-box input {
            padding: 14px 45px 14px 15px;
            border: none;
            background: transparent;
            width: 100%;
            font-size: 15px;
            outline: none;
        }

        .search-box i { 
            position: absolute;
            right: 20px;
            color: var(--secondary);
        }

        /* ===== TABLES ===== */
        .table-container { 
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .data-table { 
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }

        .data-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 18px;
            text-align: left;
            font-weight: 600;
            color: white;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td { 
            padding: 16px 18px;
            border-bottom: 1px solid #f1f1f1;
            color: var(--dark);
        }

        .data-table tr:hover { 
            background: rgba(102, 126, 234, 0.05);
        }

        .product-image { 
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stock-bajo { 
            color: var(--danger);
            font-weight: 700;
        }

        .stock-optimo { 
            color: var(--success);
            font-weight: 700;
        }

        .stock-critico { 
            color: var(--danger);
            font-weight: 700;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .loading-cell {
            text-align: center;
            padding: 40px !important;
        }

        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .loading-spinner i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, #5a6268 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e0a800 100%);
            color: var(--dark);
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1.2rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary);
        }

        .btn-icon.delete {
            color: var(--danger);
        }

        .btn-icon.delete:hover {
            background: rgba(220, 53, 69, 0.1);
        }

        .btn-icon.delete:disabled {
            color: #ccc;
            cursor: not-allowed;
            background: none;
        }

        .btn-icon.delete:disabled:hover {
            color: #ccc;
            background: none;
        }

        /* ===== BADGES ===== */
        .badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid var(--warning);
        }

        .badge-info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 1px solid var(--info);
        }

        .badge-success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 1px solid var(--success);
        }

        .badge-danger {
            background: linear-gradient(135deg, #f8d7da 0%, #f1b0b7 100%);
            color: #721c24;
            border: 1px solid var(--danger);
        }

        .badge-secondary {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            color: #495057;
            border: 1px solid var(--secondary);
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.5;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .modal-footer {
            padding: 20px 25px;
            background: #f8f9fa;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ===== NOTIFICACIONES ===== */
        .notificacion {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1100;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
        }

        .notificacion.mostrar {
            transform: translateX(0);
            opacity: 1;
        }

        .notificacion-contenido {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .notificacion.success {
            border-left: 4px solid var(--success);
        }

        .notificacion.error {
            border-left: 4px solid var(--danger);
        }

        .notificacion.info {
            border-left: 4px solid var(--info);
        }

        .notificacion.warning {
            border-left: 4px solid var(--warning);
        }

        .notificacion-cerrar {
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* ===== FILTROS ===== */
        .filtros {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filtro-select {
            padding: 12px 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: white;
            font-size: 15px;
            min-width: 200px;
        }

        /* ===== ALERTAS VENCIMIENTO ===== */
        .vencimiento-proximo {
            color: var(--warning);
            font-weight: 600;
        }

        .vencimiento-critico {
            color: var(--danger);
            font-weight: 700;
            background-color: rgba(220, 53, 69, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .vencimiento-ok {
            color: var(--success);
            font-weight: 600;
        }

        /* ===== TABLA DE ITEMS DE PEDIDO ===== */
        .items-pedido {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .items-pedido th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 1px solid #e1e5e9;
        }

        .items-pedido td {
            padding: 12px;
            border-bottom: 1px solid #f1f1f1;
        }

        .items-pedido .item-cantidad {
            width: 100px;
        }

        .items-pedido .item-precio {
            width: 120px;
        }

        .items-pedido .item-subtotal {
            width: 120px;
            font-weight: 600;
        }

        .items-pedido .item-acciones {
            width: 80px;
            text-align: center;
        }

        .total-pedido {
            display: flex;
            justify-content: flex-end;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* ===== PDF PREVIEW ===== */
        .pdf-preview {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .pdf-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
        }

        .pdf-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .pdf-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .pdf-info-section {
            flex: 1;
        }

        .pdf-info-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .pdf-table th {
            background: var(--primary);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .pdf-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
        }

        .pdf-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .pdf-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 20px;
        }

        .pdf-footer {
            margin-top: 40px;
            text-align: center;
            color: var(--secondary);
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar { 
                width: 100%;
                position: static;
            }
            
            .header {
                flex-wrap: wrap;
                height: auto;
                padding: 15px 20px;
                gap: 15px;
            }
            
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .search-box { 
                width: 100%;
                min-width: auto;
            }
            
            .data-table { 
                font-size: 0.85rem;
            }
            
            .data-table th,
            .data-table td { 
                padding: 10px 8px;
            }

            .section-header {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .filtros {
                flex-direction: column;
            }

            .filtro-select {
                width: 100%;
            }

            .items-pedido {
                font-size: 0.85rem;
            }

            .pdf-info {
                flex-direction: column;
                gap: 20px;
            }
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <h1>
                    <i class="fas fa-warehouse"></i>
                    La Merced <span>Comestibles</span>
                </h1>
            </div>
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span>Administrador</span>
            </div>
            <a href="http://127.0.0.1:8000/inicio/" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                Volver al Inicio
            </a>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <nav class="nav-menu">
                    <ul>
                        <li class="nav-item active" data-section="dashboard">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboard</span>
                        </li>
                        <li class="nav-item" data-section="productos">
                            <i class="fas fa-boxes"></i>
                            <span>Productos</span>
                        </li>
                        <li class="nav-item" data-section="categorias">
                            <i class="fas fa-tags"></i>
                            <span>Categorías</span>
                        </li>
                        <li class="nav-item" data-section="proveedores">
                            <i class="fas fa-truck"></i>
                            <span>Proveedores</span>
                        </li>
                        <li class="nav-item" data-section="pedidos">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Pedidos</span>
                        </li>
                        <li class="nav-item" data-section="vencimientos">
                            <i class="fas fa-calendar-times"></i>
                            <span>Vencimientos</span>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Content Area -->
            <main class="content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <h2><i class="fas fa-chart-line"></i> Dashboard de Stock</h2>
                    
                    <!-- Cards -->
                    <div class="dashboard-cards">
                        <div class="card card-primary">
                            <div class="card-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <div class="card-info">
                                <h3>Total Productos</h3>
                                <p id="total-productos">0</p>
                            </div>
                        </div>
                        <div class="card card-success">
                            <div class="card-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Stock Óptimo</h3>
                                <p id="stock-optimo">0</p>
                            </div>
                        </div>
                        <div class="card card-info">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Stock Bajo</h3>
                                <p id="stock-bajo">0</p>
                            </div>
                        </div>
                        <div class="card card-danger">
                            <div class="card-icon">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Sin Stock</h3>
                                <p id="sin-stock">0</p>
                            </div>
                        </div>
                        <div class="card card-warning">
                            <div class="card-icon">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                            <div class="card-info">
                                <h3>Próximos a Vencer</h3>
                                <p id="proximos-vencer">0</p>
                            </div>
                        </div>
                        <div class="card card-danger">
                            <div class="card-icon">
                                <i class="fas fa-exclamation-circle"></i>
                            </div>
                            <div class="card-info">
                                <h3>Vencidos</h3>
                                <p id="vencidos">0</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Productos Section -->
                <section id="productos" class="section">
                    <h2><i class="fas fa-boxes"></i> Gestión de Productos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar productos..." id="searchProductos">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>
                            <a href="{% url 'stock:crear_producto' %}" class="btn btn-primary me-2">
                                <i class="fas fa-plus"></i> Nuevo Producto
                            </a>
                            <a href="{% url 'stock:crear_categoria' %}" class="btn btn-success me-2">
                                <i class="fas fa-plus"></i> Nueva Categoría
                            </a>
                            <a href="{% url 'stock:crear_proveedor' %}" class="btn btn-info">
                                <i class="fas fa-plus"></i> Nuevo Proveedor
                            </a>
                        </div>
                    </div>

                    <!-- Filtros para productos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroProveedorProductos">
                            <option value="">Todos los proveedores</option>
                        </select>
                        <select class="filtro-select" id="filtroCategoriaProductos">
                            <option value="">Todas las categorías</option>
                        </select>
                        <select class="filtro-select" id="filtroEstadoProductos">
                            <option value="">Todos los estados</option>
                            <option value="optimo">Stock Óptimo</option>
                            <option value="bajo">Stock Bajo</option>
                            <option value="sin">Sin Stock</option>
                        </select>
                        <select class="filtro-select" id="filtroVencimientoProductos">
                            <option value="">Todos los vencimientos</option>
                            <option value="vencido">Vencidos</option>
                            <option value="proximo">Próximos a vencer</option>
                            <option value="ok">Vigentes</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Imagen</th>
                                    <th>Nombre</th>
                                    <th>Precio</th> 
                                    <th>Categoría</th>
                                    <th>Proveedor</th>
                                    <th>Stock</th>
                                    <th>Vencimiento</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productos-content">
                                <!-- Los productos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Categorías Section -->
                <section id="categorias" class="section">
                    <h2><i class="fas fa-tags"></i> Gestión de Categorías</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar categorías..." id="searchCategorias">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" id="btnNuevaCategoria">
                            <i class="fas fa-plus"></i>
                            Nueva Categoría
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Descripción</th>
                                    <th>Productos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="categorias-content">
                                <!-- Las categorías se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Proveedores Section -->
                <section id="proveedores" class="section">
                    <h2><i class="fas fa-truck"></i> Gestión de Proveedores</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar proveedores..." id="searchProveedores">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" id="btnNuevoProveedor">
                            <i class="fas fa-plus"></i>
                            Nuevo Proveedor
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Contacto</th>
                                    <th>Teléfono</th>
                                    <th>Productos</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="proveedores-content">
                                <!-- Los proveedores se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Pedidos Section -->
                <section id="pedidos" class="section">
                    <h2><i class="fas fa-clipboard-list"></i> Gestión de Pedidos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar pedidos..." id="searchPedidos">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" id="btnNuevoPedido">
                            <i class="fas fa-plus"></i>
                            Nuevo Pedido
                        </button>
                    </div>

                    <!-- Filtros para pedidos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroProveedorPedidos">
                            <option value="">Todos los proveedores</option>
                        </select>
                        <select class="filtro-select" id="filtroEstadoPedidos">
                            <option value="">Todos los estados</option>
                            <option value="pendiente">Pendiente</option>
                            <option value="confirmado">Confirmado</option>
                            <option value="en_camino">En Camino</option>
                            <option value="recibido">Recibido</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                        <select class="filtro-select" id="filtroFechaPedidos">
                            <option value="">Todas las fechas</option>
                            <option value="hoy">Hoy</option>
                            <option value="semana">Esta semana</option>
                            <option value="mes">Este mes</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Proveedor</th>
                                    <th>Fecha</th>
                                    <th>Productos</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-content">
                                <!-- Los pedidos se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Vencimientos Section -->
                <section id="vencimientos" class="section">
                    <h2><i class="fas fa-calendar-times"></i> Control de Vencimientos</h2>
                    
                    <div class="section-header">
                        <div class="search-box">
                            <input type="text" placeholder="Buscar productos..." id="searchVencimientos">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-warning" id="btnReporteVencimientos">
                            <i class="fas fa-file-pdf"></i>
                            Generar Reporte
                        </button>
                    </div>

                    <!-- Filtros para vencimientos -->
                    <div class="filtros">
                        <select class="filtro-select" id="filtroEstadoVencimiento">
                            <option value="">Todos los estados</option>
                            <option value="vencido">Vencidos</option>
                            <option value="proximo">Próximos a vencer</option>
                            <option value="ok">Vigentes</option>
                        </select>
                        <select class="filtro-select" id="filtroDiasVencimiento">
                            <option value="">Todos los rangos</option>
                            <option value="7">Próximos 7 días</option>
                            <option value="15">Próximos 15 días</option>
                            <option value="30">Próximos 30 días</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Producto</th>
                                    <th>Categoría</th>
                                    <th>Stock</th>
                                    <th>Fecha Vencimiento</th>
                                    <th>Días Restantes</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="vencimientos-content">
                                <!-- Los productos con vencimiento se cargarán aquí -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modal para Productos -->
    <div class="modal" id="modalProducto">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalProductoTitulo">Nuevo Producto</h3>
                <button class="modal-close" id="modalProductoCerrar">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProducto">
                    <input type="hidden" id="productoId">
                    <div class="form-group">
                        <label for="productoNombre">Nombre</label>
                        <input type="text" id="productoNombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="productoCategoria">Categoría</label>
                        <select id="productoCategoria" class="form-control" required>
                            <option value="">Seleccione una categoría</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productoStock">Stock Actual</label>
                            <input type="number" id="productoStock" class="form-control" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="productoStockMinimo">Stock Mínimo</label>
                            <input type="number" id="productoStockMinimo" class="form-control" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productoProveedor">Proveedor</label>
                        <select id="productoProveedor" class="form-control" required>
                            <option value="">Seleccione un proveedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productoVencimiento">Fecha de Vencimiento</label>
                        <input type="date" id="productoVencimiento" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="productoLote">Número de Lote (Opcional)</label>
                        <input type="text" id="productoLote" class="form-control" placeholder="LOTE-001">
                    </div>
                    <div class="form-group">
                        <label for="productoImagen">URL de Imagen</label>
                        <input type="text" id="productoImagen" class="form-control" placeholder="https://...">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalProductoCancelar">Cancelar</button>
                <button class="btn btn-primary" id="modalProductoGuardar">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Categorías -->
    <div class="modal" id="modalCategoria">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalCategoriaTitulo">Nueva Categoría</h3>
                <button class="modal-close" id="modalCategoriaCerrar">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formCategoria">
                    <input type="hidden" id="categoriaId">
                    <div class="form-group">
                        <label for="categoriaNombre">Nombre</label>
                        <input type="text" id="categoriaNombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="categoriaDescripcion">Descripción</label>
                        <textarea id="categoriaDescripcion" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCategoriaCancelar">Cancelar</button>
                <button class="btn btn-primary" id="modalCategoriaGuardar">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Proveedores -->
    <div class="modal" id="modalProveedor">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalProveedorTitulo">Nuevo Proveedor</h3>
                <button class="modal-close" id="modalProveedorCerrar">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formProveedor">
                    <input type="hidden" id="proveedorId">
                    <div class="form-group">
                        <label for="proveedorNombre">Nombre</label>
                        <input type="text" id="proveedorNombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorContacto">Persona de Contacto</label>
                        <input type="text" id="proveedorContacto" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorTelefono">Teléfono</label>
                        <input type="tel" id="proveedorTelefono" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="proveedorEmail">Email</label>
                        <input type="email" id="proveedorEmail" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalProveedorCancelar">Cancelar</button>
                <button class="btn btn-primary" id="modalProveedorGuardar">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Pedidos -->
    <div class="modal" id="modalPedido">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalPedidoTitulo">Nuevo Pedido</h3>
                <button class="modal-close" id="modalPedidoCerrar">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formPedido">
                    <input type="hidden" id="pedidoId">
                    <div class="form-group">
                        <label for="pedidoProveedor">Proveedor</label>
                        <select id="pedidoProveedor" class="form-control" required>
                            <option value="">Seleccione un proveedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pedidoFecha">Fecha de Entrega Esperada</label>
                        <input type="date" id="pedidoFecha" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="pedidoEstado">Estado</label>
                        <select id="pedidoEstado" class="form-control" required>
                            <option value="pendiente">Pendiente</option>
                            <option value="confirmado">Confirmado</option>
                            <option value="en_camino">En Camino</option>
                            <option value="recibido">Recibido</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Productos del Pedido</label>
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <select id="pedidoProducto" class="form-control">
                                    <option value="">Seleccione un producto</option>
                                </select>
                            </div>
                            <div class="form-group item-cantidad">
                                <input type="number" id="pedidoCantidad" class="form-control" placeholder="Cantidad" min="1" value="1">
                            </div>
                            <div class="form-group item-precio">
                                <input type="number" id="pedidoPrecio" class="form-control" placeholder="Precio" min="0" step="0.01">
                            </div>
                            <div class="form-group item-acciones">
                                <button type="button" class="btn btn-success" id="btnAgregarProducto">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <table class="items-pedido">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th class="item-cantidad">Cantidad</th>
                                <th class="item-precio">Precio Unit.</th>
                                <th class="item-subtotal">Subtotal</th>
                                <th class="item-acciones">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="pedidoItems">
                            <!-- Los items del pedido se agregarán aquí -->
                        </tbody>
                    </table>
                    
                    <div class="total-pedido">
                        Total: $<span id="pedidoTotal">0.00</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="pedidoNotas">Notas (Opcional)</label>
                        <textarea id="pedidoNotas" class="form-control" rows="3" placeholder="Notas adicionales sobre el pedido..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalPedidoCancelar">Cancelar</button>
                <button class="btn btn-primary" id="modalPedidoGuardar">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para PDF Preview -->
    <div class="modal" id="modalPDF">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3>Vista Previa del PDF - Pedido #<span id="pdfPedidoId"></span></h3>
                <button class="modal-close" id="modalPDFCerrar">&times;</button>
            </div>
            <div class="modal-body">
                <div class="pdf-preview" id="pdfPreview">
                    <!-- Contenido del PDF se generará aquí -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalPDFCancelar">Cerrar</button>
                <button class="btn btn-primary" id="modalPDFDescargar">
                    <i class="fas fa-download"></i> Descargar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Al final del archivo, antes de </body> -->
    <script>
        // URLs base
        const API_PRODUCTOS = '/stock/api/productos/';
        const API_CATEGORIAS = '/stock/api/categorias/';
        const API_PROVEEDORES = '/stock/api/proveedores/';

        // Variables globales para los datos
        let productos = [];
        let categorias = [];
        let proveedores = [];

        // ===== FUNCIONES BÁSICAS =====
        function getCSRFToken() {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                ?.split('=')[1];
            return cookieValue || '';
        }

        function mostrarMensaje(mensaje, tipo = 'info') {
            // Crear elemento de notificación
            const notificacion = document.createElement('div');
            notificacion.className = `notificacion ${tipo}`;
            
            let icono = 'info-circle';
            if (tipo === 'success') icono = 'check-circle';
            if (tipo === 'error') icono = 'exclamation-circle';
            if (tipo === 'warning') icono = 'exclamation-triangle';
            
            notificacion.innerHTML = `
                <div class="notificacion-contenido">
                    <i class="fas fa-${icono}"></i>
                    <span>${mensaje}</span>
                </div>
                <button class="notificacion-cerrar">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notificacion);
            
            setTimeout(() => notificacion.classList.add('mostrar'), 100);
            
            setTimeout(() => {
                notificacion.classList.remove('mostrar');
                setTimeout(() => notificacion.remove(), 300);
            }, 5000);
            
            notificacion.querySelector('.notificacion-cerrar').addEventListener('click', function() {
                notificacion.classList.remove('mostrar');
                setTimeout(() => notificacion.remove(), 300);
            });
        }

        // ===== FUNCIONES DE CARGA DE DATOS =====
        async function fetchAPI(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': getCSRFToken(),
                    },
                    ...options
                });
                
                if (!response.ok) throw new Error(`Error ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error en fetchAPI:', error);
                throw error;
            }
        }

        async function cargarDatosReales() {
            try {
                console.log('🔄 Cargando datos...');
                
                productos = await fetchAPI(API_PRODUCTOS);
                categorias = await fetchAPI(API_CATEGORIAS);
                proveedores = await fetchAPI(API_PROVEEDORES);
                
                cargarProductos();
                cargarCategorias();
                cargarProveedores();
                cargarDashboard();
                cargarFiltros();
                
            } catch (error) {
                console.error('❌ Error cargando datos:', error);
                mostrarMensaje('Error al cargar los datos', 'error');
            }
        }

        // ===== FUNCIONES PARA PRODUCTOS =====
        function cargarProductos() {
            const tbody = document.getElementById('productos-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (productos.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <i class="fas fa-box-open"></i>
                            <h3>No hay productos</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            productos.forEach(producto => {
                const estadoStock = producto.stock === 0 ? 
                    '<span class="badge badge-danger">Sin Stock</span>' : 
                    producto.stock <= 10 ? 
                    '<span class="badge badge-warning">Stock Bajo</span>' : 
                    '<span class="badge badge-success">Óptimo</span>';
                
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${producto.id}</td>
                    <td>
                        <img src="${producto.imagen}" alt="${producto.nombre}" class="product-image">
                    </td>
                    <td>${producto.nombre}</td>
                    <td>$${producto.precio?.toFixed(2) || '0.00'}</td>
                    <td>${producto.categoria}</td>
                    <td>${producto.proveedor}</td>
                    <td>${producto.stock}</td>
                    <td>No definida</td>
                    <td>${estadoStock}</td>
                    <td>
                        <a href="/stock/productos/${producto.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProducto(${producto.id}, '${producto.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${producto.stock > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES PARA CATEGORÍAS =====
        function cargarCategorias() {
            const tbody = document.getElementById('categorias-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (categorias.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-tags"></i>
                            <h3>No hay categorías</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            categorias.forEach(categoria => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${categoria.id}</td>
                    <td>${categoria.nombre}</td>
                    <td>${categoria.descripcion}</td>
                    <td>${categoria.productos_count}</td>
                    <td>
                        <a href="/stock/categorias/${categoria.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarCategoria(${categoria.id}, '${categoria.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${categoria.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES PARA PROVEEDORES =====
        function cargarProveedores() {
            const tbody = document.getElementById('proveedores-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (proveedores.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-truck"></i>
                            <h3>No hay proveedores</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            proveedores.forEach(proveedor => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${proveedor.id}</td>
                    <td>${proveedor.nombre}</td>
                    <td>${proveedor.telefono}</td>
                    <td>${proveedor.email}</td>
                    <td>${proveedor.productos_count} productos</td>
                    <td>
                        <a href="/stock/proveedores/${proveedor.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProveedor(${proveedor.id}, '${proveedor.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${proveedor.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== FUNCIONES DE ELIMINACIÓN =====
        async function eliminarProducto(id, nombre) {
            if (!confirm(`¿Eliminar producto "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/productos/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Producto "${nombre}" eliminado`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        async function eliminarCategoria(id, nombre) {
            if (!confirm(`¿Eliminar categoría "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/categorias/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Categoría "${nombre}" eliminada`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        async function eliminarProveedor(id, nombre) {
            if (!confirm(`¿Eliminar proveedor "${nombre}"?`)) return;
            
            try {
                const response = await fetch(`/stock/api/proveedores/${id}/eliminar/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'X-Requested-With': 'XMLHttpRequest',
                    }
                });
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensaje(`✅ Proveedor "${nombre}" eliminado`, 'success');
                    await cargarDatosReales();
                } else {
                    mostrarMensaje(`❌ Error: ${result.error}`, 'error');
                }
            } catch (error) {
                mostrarMensaje('❌ Error de conexión', 'error');
            }
        }

        // ===== FUNCIONES AUXILIARES =====
        function cargarFiltros() {
            const filtroProveedor = document.getElementById('filtroProveedorProductos');
            if (filtroProveedor) {
                filtroProveedor.innerHTML = '<option value="">Todos los proveedores</option>';
                proveedores.forEach(proveedor => {
                    filtroProveedor.innerHTML += `<option value="${proveedor.id}">${proveedor.nombre}</option>`;
                });
            }

            const filtroCategoria = document.getElementById('filtroCategoriaProductos');
            if (filtroCategoria) {
                filtroCategoria.innerHTML = '<option value="">Todas las categorías</option>';
                categorias.forEach(categoria => {
                    filtroCategoria.innerHTML += `<option value="${categoria.id}">${categoria.nombre}</option>`;
                });
            }
        }

        function cargarDashboard() {
            if (!productos.length) return;

            const totalProductos = productos.length;
            const stockOptimo = productos.filter(p => p.stock > 10).length;
            const stockBajo = productos.filter(p => p.stock <= 10 && p.stock > 0).length;
            const sinStock = productos.filter(p => p.stock === 0).length;
            
            document.getElementById('total-productos').textContent = totalProductos;
            document.getElementById('stock-optimo').textContent = stockOptimo;
            document.getElementById('stock-bajo').textContent = stockBajo;
            document.getElementById('sin-stock').textContent = sinStock;
            document.getElementById('vencidos').textContent = '0';
            document.getElementById('proximos-vencer').textContent = '0';
        }

        // ===== FUNCIONES DE FILTRADO =====
        function filtrarProductos() {
            const termino = document.getElementById('searchProductos').value.toLowerCase();
            const filtroProveedor = document.getElementById('filtroProveedorProductos')?.value || '';
            const filtroCategoria = document.getElementById('filtroCategoriaProductos')?.value || '';
            const filtroEstado = document.getElementById('filtroEstadoProductos')?.value || '';
            
            const productosFiltrados = productos.filter(p => {
                const coincideTermino = p.nombre.toLowerCase().includes(termino) || 
                    p.categoria.toLowerCase().includes(termino);
                
                const coincideProveedor = !filtroProveedor || p.proveedor_id == filtroProveedor;
                const coincideCategoria = !filtroCategoria || p.categoria_id == filtroCategoria;
                
                let coincideEstado = true;
                if (filtroEstado === 'optimo') {
                    coincideEstado = p.stock > 10;
                } else if (filtroEstado === 'bajo') {
                    coincideEstado = p.stock <= 10 && p.stock > 0;
                } else if (filtroEstado === 'sin') {
                    coincideEstado = p.stock === 0;
                }
                
                return coincideTermino && coincideProveedor && coincideCategoria && coincideEstado;
            });
            
            const tbody = document.getElementById('productos-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (productosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron productos</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            productosFiltrados.forEach(producto => {
                const estadoStock = producto.stock === 0 ? 
                    '<span class="badge badge-danger">Sin Stock</span>' : 
                    producto.stock <= 10 ? 
                    '<span class="badge badge-warning">Stock Bajo</span>' : 
                    '<span class="badge badge-success">Óptimo</span>';
                
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${producto.id}</td>
                    <td>
                        <img src="${producto.imagen}" alt="${producto.nombre}" class="product-image">
                    </td>
                    <td>${producto.nombre}</td>
                    <td>$${producto.precio?.toFixed(2) || '0.00'}</td>
                    <td>${producto.categoria}</td>
                    <td>${producto.proveedor}</td>
                    <td>${producto.stock}</td>
                    <td>No definida</td>
                    <td>${estadoStock}</td>
                    <td>
                        <a href="/stock/productos/${producto.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProducto(${producto.id}, '${producto.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${producto.stock > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        function filtrarCategorias() {
            const termino = document.getElementById('searchCategorias').value.toLowerCase();
            const categoriasFiltradas = categorias.filter(cat => 
                cat.nombre.toLowerCase().includes(termino) || 
                (cat.descripcion && cat.descripcion.toLowerCase().includes(termino))
            );
            
            const tbody = document.getElementById('categorias-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (categoriasFiltradas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron categorías</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            categoriasFiltradas.forEach(categoria => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${categoria.id}</td>
                    <td>${categoria.nombre}</td>
                    <td>${categoria.descripcion}</td>
                    <td>${categoria.productos_count}</td>
                    <td>
                        <a href="/stock/categorias/${categoria.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarCategoria(${categoria.id}, '${categoria.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${categoria.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        function filtrarProveedores() {
            const termino = document.getElementById('searchProveedores').value.toLowerCase();
            const proveedoresFiltrados = proveedores.filter(prov => 
                prov.nombre.toLowerCase().includes(termino) || 
                prov.telefono.toLowerCase().includes(termino) ||
                prov.email.toLowerCase().includes(termino)
            );
            
            const tbody = document.getElementById('proveedores-content');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (proveedoresFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No se encontraron proveedores</h3>
                        </td>
                    </tr>
                `;
                return;
            }
            
            proveedoresFiltrados.forEach(proveedor => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td>${proveedor.id}</td>
                    <td>${proveedor.nombre}</td>
                    <td>${proveedor.telefono}</td>
                    <td>${proveedor.email}</td>
                    <td>${proveedor.productos_count} productos</td>
                    <td>
                        <a href="/stock/proveedores/${proveedor.id}/editar/" class="btn-icon" title="Editar">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button class="btn-icon delete" onclick="eliminarProveedor(${proveedor.id}, '${proveedor.nombre.replace(/'/g, "\\'")}')" 
                                title="Eliminar" ${proveedor.productos_count > 0 ? 'disabled' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(fila);
            });
        }

        // ===== INICIALIZACIÓN =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inicializando Gestión de Stock...');
            
            // Cargar datos
            cargarDatosReales();
            
            // Configurar búsquedas
            document.getElementById('searchProductos')?.addEventListener('input', filtrarProductos);
            document.getElementById('searchCategorias')?.addEventListener('input', filtrarCategorias);
            document.getElementById('searchProveedores')?.addEventListener('input', filtrarProveedores);
            
            // Configurar filtros
            document.getElementById('filtroProveedorProductos')?.addEventListener('change', filtrarProductos);
            document.getElementById('filtroCategoriaProductos')?.addEventListener('change', filtrarProductos);
            document.getElementById('filtroEstadoProductos')?.addEventListener('change', filtrarProductos);

            // Configurar navegación
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                    
                    this.classList.add('active');
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId)?.classList.add('active');
                });
            });

            console.log('✅ Gestión de Stock inicializada');
        });
    </script>
</body>
</html>
