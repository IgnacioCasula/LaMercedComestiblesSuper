{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Nóminas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'CSS/gestion_nominas.css' %}">
</head>
<body>
    <div class="container">
        <header class="page-header">
            <h1><i class="fas fa-money-bill-wave"></i> Gestión de Nóminas y Pagos</h1>
            <div class="header-actions">
                <div class="info-periodo" id="info-periodo">
                    <i class="fas fa-calendar-week"></i>
                    <strong>Cargando...</strong>
                </div>
                <a href="{% url 'inicio' %}" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Volver
                </a>
            </div>
        </header>

        <div class="filters-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Buscar empleado por nombre, DNI...">
            </div>
            
            <div class="filters-row">
                <div class="filter-group">
                    <label>Estado de Pago:</label>
                    <select id="filter-estado" class="filter-select">
                        <option value="all">Todos</option>
                        <option value="pagado">✓ Al Día (Verde)</option>
                        <option value="pendiente">○ Pendiente (Amarillo)</option>
                        <option value="alerta">⚠ Alerta (Naranja)</option>
                        <option value="critico">✖ Crítico (Rojo)</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>Área:</label>
                    <select id="filter-area" class="filter-select">
                        <option value="all">Todas las áreas</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="stats-cards">
            <div class="stat-card stat-total">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-info">
                    <h3 id="stat-empleados">0</h3>
                    <p>Empleados Activos</p>
                </div>
            </div>
            <div class="stat-card stat-horas">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-info">
                    <h3 id="stat-horas">0h</h3>
                    <p>Horas Esta Semana</p>
                </div>
            </div>
            <div class="stat-card stat-deuda">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-info">
                    <h3 id="stat-deuda">$0</h3>
                    <p>Total a Pagar</p>
                </div>
            </div>
        </div>

        <div class="table-container">
            <div class="table-header">
                <div class="table-title">
                    <i class="fas fa-list"></i> Lista de Empleados
                </div>
                <div class="table-legend">
                    <span class="legend-item"><span class="legend-dot green"></span> Al día</span>
                    <span class="legend-item"><span class="legend-dot yellow"></span> Pendiente</span>
                    <span class="legend-item"><span class="legend-dot orange"></span> Alerta</span>
                    <span class="legend-item"><span class="legend-dot red"></span> Crítico</span>
                </div>
            </div>

            <div id="empleados-container" class="empleados-container">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i> Cargando datos...
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: DETALLE EMPLEADO -->
    <div id="modal-detalle" class="modal-overlay">
        <div class="modal-content modal-xlarge">
            <h2 id="modal-detalle-titulo">
                <i class="fas fa-user"></i> Detalle de Empleado
            </h2>

            <div class="modal-body-grid">
                <!-- COLUMNA IZQUIERDA -->
                <div class="modal-col">
                    <!-- Información Personal -->
                    <div class="info-section">
                        <h3><i class="fas fa-id-card"></i> Información Personal</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Nombre Completo:</label>
                                <span id="detalle-nombre">-</span>
                            </div>
                            <div class="info-item">
                                <label>DNI:</label>
                                <span id="detalle-dni">-</span>
                            </div>
                            <div class="info-item">
                                <label>Período:</label>
                                <span id="detalle-periodo">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen Financiero -->
                    <div class="info-section">
                        <h3><i class="fas fa-calculator"></i> Resumen Financiero</h3>
                        <div class="resumen-financiero">
                            <div class="resumen-item semana">
                                <label><i class="fas fa-clock"></i> Horas Esta Semana:</label>
                                <span id="detalle-horas-semana">0h</span>
                            </div>
                            <div class="resumen-item semana">
                                <label><i class="fas fa-coins"></i> Devengado Esta Semana:</label>
                                <span id="detalle-devengado-semana">$0</span>
                            </div>
                            <div class="resumen-item deuda">
                                <label><i class="fas fa-exclamation-triangle"></i> Deuda Acumulada:</label>
                                <span id="detalle-deuda-acumulada">$0</span>
                            </div>
                            <div class="resumen-item total">
                                <label><i class="fas fa-dollar-sign"></i> TOTAL A PAGAR:</label>
                                <span id="detalle-total-pagar">$0</span>
                            </div>
                        </div>
                        <button class="btn btn-success btn-block" id="btn-detalle-pagar">
                            <i class="fas fa-hand-holding-usd"></i> Registrar Pago
                        </button>
                    </div>

                    <!-- Historial Semanal -->
                    <div class="info-section">
                        <h3><i class="fas fa-history"></i> Historial Semanal</h3>
                        <div id="historial-semanal" class="historial-container"></div>
                    </div>
                </div>

                <!-- COLUMNA DERECHA -->
                <div class="modal-col">
                    <!-- Roles -->
                    <div class="info-section">
                        <h3><i class="fas fa-briefcase"></i> Roles / Puestos</h3>
                        <p class="info-text">Haz clic en un rol para ver sus asistencias específicas</p>
                        <div id="detalle-roles" class="roles-container"></div>
                        <button class="btn btn-light btn-sm btn-block" onclick="filtrarPorRol(null)">
                            <i class="fas fa-list"></i> Ver Todos los Roles
                        </button>
                    </div>

                    <!-- Asistencias -->
                    <div class="info-section">
                        <h3><i class="fas fa-calendar-check"></i> Asistencias (Semana Actual)</h3>
                        <div id="historial-asistencias" class="historial-container"></div>
                    </div>

                    <!-- Pagos Recientes -->
                    <div class="info-section">
                        <h3><i class="fas fa-receipt"></i> Pagos Recientes</h3>
                        <div id="pagos-recientes" class="historial-container"></div>
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-light" id="btn-detalle-cerrar">
                    <i class="fas fa-times"></i> Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTRAR PAGO -->
    <div id="modal-pago" class="modal-overlay">
        <div class="modal-content">
            <h2><i class="fas fa-hand-holding-usd"></i> Registrar Pago</h2>
            
            <div class="modal-body">
                <div class="alert-info">
                    <i class="fas fa-info-circle"></i>
                    Monto máximo a pagar: <strong>$<span id="pago-monto-max">0.00</span></strong>
                </div>

                <div class="form-group">
                    <label for="pago-monto">Monto a Pagar: *</label>
                    <input type="number" id="pago-monto" class="form-control" step="0.01" min="0" required>
                </div>

                <div class="form-group">
                    <label for="pago-metodo">Método de Pago: *</label>
                    <select id="pago-metodo" class="form-control" required>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Transferencia">Transferencia</option>
                        <option value="Cheque">Cheque</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pago-comprobante">Número de Comprobante:</label>
                    <input type="text" id="pago-comprobante" class="form-control" placeholder="Opcional">
                </div>

                <div class="form-group">
                    <label for="pago-observacion">Observación:</label>
                    <textarea id="pago-observacion" class="form-control" rows="3" placeholder="Opcional"></textarea>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-light" id="btn-pago-cancelar">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="button" class="btn btn-success" id="btn-pago-confirmar">
                    <i class="fas fa-check"></i> Confirmar Pago
                </button>
            </div>
        </div>
    </div>

    <script src="{% static 'JS/audio-system.js' %}"></script>
    <script src="{% static 'JS/gestion_nominas.js' %}"></script>
</body>
</html>